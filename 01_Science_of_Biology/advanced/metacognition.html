<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metacognition Discovery Lab: Evidence-Based Learning for PreMed</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --uwp-green: #016836;
            --uwp-black: #21272a;
            --uwp-dark-green: #00502f;
            --uwp-cool-grey: #dbd9d6;
            --uwp-goldenrod: #faba31;
            --uwp-white-birch: #efece2;
            --bg: #f8fafc;
            --ink: #000000;
            --muted: #000000;
            --card-bg: #ffffff;
            --card-border: #e5e7eb;
            --btn-primary-bg: var(--uwp-green);
            --btn-primary-text: #ffffff;
            --btn-secondary-bg: #ffffff;
            --btn-secondary-text: var(--uwp-green);
            --progress-track: var(--uwp-cool-grey);
            --progress-bar: var(--uwp-green);
        }
        * { box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(180deg, var(--uwp-white-birch), #ffffff); color: var(--ink); min-height: 100vh; display: flex; flex-direction: column; }
        header { background: linear-gradient(90deg, var(--uwp-dark-green), var(--uwp-green)); border-bottom: 3px solid var(--uwp-goldenrod); color: #ffffff; padding: 0.8rem 1rem; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        main { flex: 1; padding: 1.5rem 1rem; max-width: 1200px; width: 100%; margin: 0 auto; }
        footer { background: var(--uwp-black); color: #ffffff; border-top: 3px solid var(--uwp-green); padding: 1rem; font-size: 0.8rem; margin-top: auto; }
        .shell { max-width: 1200px; margin: 0 auto; padding: 0 1rem; display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; }
        footer .shell { flex-direction: column; align-items: flex-start; gap: 0.4rem; }
        .header-brand { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; font-size: 1rem; }
        .header-brand-icon { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--uwp-goldenrod); display: flex; align-items: center; justify-content: center; font-size: 0.7rem; background: rgba(255, 255, 255, 0.1); }
        .progress-shell { flex: 1; display: flex; flex-direction: column; gap: 0.3rem; max-width: 800px; }
        .progress-track { flex: 1; height: 8px; border-radius: 999px; background: var(--progress-track); overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; border-radius: 999px; background: var(--progress-bar); transition: width 0.3s ease; }
        .progress-labels { display: flex; justify-content: space-between; width: 100%; font-size: 0.7rem; color: #ffffff; }
        .progress-label-item { flex: 1; text-align: center; padding: 0.2rem; opacity: 0.5; transition: opacity 0.3s ease; position: relative; font-size: 0.65rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .progress-label-item.completed { opacity: 1; font-weight: 600; }
        .progress-label-item.current { opacity: 1; color: var(--uwp-goldenrod); font-weight: 700; }
        .progress-label-item::after { content: '→'; position: absolute; right: -2px; opacity: 0.5; }
        .progress-label-item:last-child::after { content: ''; }
        .progress-label { font-size: 0.75rem; white-space: nowrap; color: #ffffff; margin-top: 0.2rem; }
        h1, h2, h3 { margin: 0; font-weight: 600; letter-spacing: 0.02em; }
        h1 { font-size: 1.4rem; color: var(--uwp-green); margin-bottom: 0.3rem; }
        h2 { font-size: 1.2rem; color: var(--uwp-black); margin-bottom: 0.2rem; }
        h3 { font-size: 1rem; color: var(--uwp-dark-green); margin: 0.3rem 0; }
        p { margin: 0.3rem 0; line-height: 1.5; }
        .subline { font-size: 0.9rem; color: var(--muted); margin-top: 0.15rem; }
        .meta { font-size: 0.8rem; color: var(--muted); }
        .card { background: var(--card-bg); border-radius: 0.6rem; border: 1px solid var(--card-border); padding: 1rem; box-shadow: 0 2px 6px rgba(33, 39, 42, 0.06); transition: box-shadow 0.2s ease, transform 0.2s ease; }
        .card:hover { box-shadow: 0 4px 12px rgba(33, 39, 42, 0.1); transform: translateY(-2px); }
        .card.stack { display: flex; flex-direction: column; gap: 0.4rem; }
        .btn { border-radius: 999px; padding: 0.5rem 1rem; font-size: 0.9rem; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.4rem; border: 1px solid transparent; font-weight: 500; transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, transform 0.1s ease; white-space: nowrap; }
        .btn:focus { outline: 2px solid var(--uwp-green); outline-offset: 2px; }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-primary { background: var(--btn-primary-bg); color: var(--btn-primary-text); border-color: rgba(0, 0, 0, 0.1); }
        .btn-primary:hover:not(:disabled) { background: var(--uwp-dark-green); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 104, 54, 0.2); }
        .btn-secondary { background: var(--btn-secondary-bg); color: var(--btn-secondary-text); border-color: var(--uwp-green); border-width: 1.5px; }
        .btn-secondary:hover:not(:disabled) { background: var(--uwp-green); color: #ffffff; transform: translateY(-2px); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .btn-lg { padding: 0.7rem 1.4rem; font-size: 1rem; }
        .btn-full-width { width: 100%; }
        .dashboard-grid { display: grid; gap: 0.8rem; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); margin-top: 1rem; }
        .banner { border-left: 3px solid var(--uwp-green); padding-left: 0.8rem; margin-bottom: 1rem; }
        .banner h2 { margin-top: 0; }
        .view { display: none; max-width: 960px; width: 100%; margin: 0 auto; }
        .view.active { display: block; }
        .chip { display: inline-flex; align-items: center; padding: 0.1rem 0.5rem; border-radius: 999px; font-size: 0.75rem; border: 1px solid var(--uwp-green); color: var(--uwp-green); background: #ffffff; }
        .chip.completed { background: var(--uwp-green); color: #ffffff; }
        .observation-box { background: var(--uwp-white-birch); border-radius: 0.5rem; border: 1px solid var(--card-border); padding: 0.5rem 0.6rem; font-style: italic; color: var(--ink); margin-bottom: 0.35rem; }
        .explanation-box { background: #f0f9ff; border-left: 3px solid var(--uwp-green); border-radius: 0.3rem; padding: 0.5rem 0.6rem; margin-bottom: 0.5rem; font-size: 0.9rem; }
        textarea, input, select { width: 100%; border-radius: 0.4rem; border: 1px solid #cbd5e1; padding: 0.45rem 0.5rem; background: #ffffff; color: #000000; font-size: 0.9rem; font-family: inherit; margin: 0; }
        textarea { min-height: 120px; resize: vertical; }
        label { display: block; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.08em; color: #000000; margin-bottom: 0.15rem; font-weight: 600; }
        .field { margin-bottom: 0.4rem; }
        .hidden { display: none !important; }
        .pill-nav { display: flex; gap: 0.35rem; flex-wrap: wrap; margin-bottom: 0.35rem; }
        .data-viz-box { background: #f8fafc; border: 1px solid var(--card-border); border-radius: 0.6rem; padding: 1rem; margin: 0.5rem 0; }
        .row-flex { display: flex; gap: 1rem; flex-wrap: wrap; align-items: flex-start; }
        @media (min-width: 600px) { .row-flex > * { flex: 1; min-width: 250px; } }
        input[type="date"], input[type="number"], input[type="range"] { width: 100%; }
        input[type="checkbox"], input[type="radio"] { width: auto; margin-right: 0.35rem; cursor: pointer; }
        .checkbox-label { display: flex; align-items: center; gap: 0.3rem; cursor: pointer; margin-bottom: 0.2rem; }
        .radio-group { display: flex; flex-direction: column; gap: 0.3rem; }
        footer p { margin: 0.2rem 0; line-height: 1.4; }
        footer a { color: var(--uwp-goldenrod); text-decoration: none; }
        footer a:hover { text-decoration: underline; }
        .hypothesis-feedback { display: none; background: #e8f5e9; border-left: 3px solid #4caf50; border-radius: 0.3rem; padding: 0.5rem 0.6rem; margin: 0.5rem 0; }
        .citation-box { background: #f8fafc; border: 1px solid var(--card-border); border-radius: 0.4rem; padding: 0.8rem; font-size: 0.8rem; margin: 0.5rem 0; }
        .stats-box { background: #f0f9ff; border: 1px solid #b3e0ff; border-radius: 0.4rem; padding: 0.8rem; margin: 0.5rem 0; }
        @media (max-width: 640px) {
            header { padding: 0.6rem 0.8rem; }
            main { padding: 1rem 0.8rem; }
            .shell { flex-wrap: wrap; gap: 0.3rem; }
            header .shell { flex-direction: column; align-items: flex-start; }
            .progress-shell { width: 100%; max-width: none; }
            h1 { font-size: 1.2rem; }
            h2 { font-size: 1.1rem; }
            .btn { font-size: 0.85rem; padding: 0.45rem 0.9rem; }
            .progress-label-item { font-size: 0.6rem; }
        }
    </style>
<style>
.bios-nav {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: #016836;
  border-bottom: 2px solid #FFD100;
}
.bios-nav-inner {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 4px 8px;
}
.bios-home {
  color: white;
  font-weight: 700;
  text-decoration: none;
  letter-spacing: .5px;
}
.bios-toggle {
  display: none;
  background: none;
  border: none;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
}
.bios-menus {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}
.bios-menu { position: relative; }
.bios-trigger {
  background: none;
  border: none;
  color: white;
  font-weight: 600;
  cursor: pointer;
  padding: 2px 4px;
}
.bios-trigger.active {
  border-bottom: 2px solid #FFD100;
}
.bios-dropdown {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: white;
  border: 1px solid #ccc;
  min-width: 160px;
  z-index: 1001;
}
.bios-dropdown a {
  display: block;
  padding: 6px 10px;
  color: #212721;
  text-decoration: none;
}
.bios-dropdown a:hover {
  background: #EFECE2;
}
.bios-menu:hover .bios-dropdown,
.bios-menu:focus-within .bios-dropdown {
  display: block;
}
@media (max-width: 768px) {
  .bios-toggle { display: block; }
  .bios-menus {
    display: none;
    flex-direction: column;
    background: #016836;
    width: 100%;
  }
  .bios-menus.open { display: flex; }
  .bios-dropdown {
    position: static;
    border: none;
  }
}
</style>
</head>
<body>
<nav class="bios-nav">
  <div class="bios-nav-inner">
    <a href="../index.html" class="bios-home">BIOS101</a>
    <button class="bios-toggle" aria-label="Toggle menu">â˜°</button>
    <div class="bios-menus" id="biosMenus"></div>
  </div>
</nav>
    <header>
        <div class="shell">
            <div class="header-brand">
                <div class="header-brand-icon">UWP</div>
                <span>Metacognition Discovery Lab: Evidence-Based Learning for PreMed</span>
            </div>
            <div class="progress-shell">
                <div class="progress-track">
                    <div class="progress-bar" id="globalProgressBar"></div>
                </div>
                <div class="progress-labels" id="progressLabels">
                    <!-- Dynamic progress labels will be inserted here -->
                </div>
                <div class="progress-label" id="globalProgressLabel">0 of 10 experiments</div>
            </div>
        </div>
    </header>

    <main>
        <div class="view active" id="view-landing">
            <div class="banner">
                <h1>When Hard Work Doesn't Match Your Exam Score</h1>
                <p class="subline">You didn't fail because you were lazy—you failed because your brain was busy looking like it was learning instead of actually learning. Strategies like <strong>passive rereading, indiscriminately highlighting, transcribing notes, or marathon cramming</strong> all feel safe and productive, but they primarily strengthen <strong>encoding</strong>—the process of putting information in. Exams, however, are tests of <strong>retrieval</strong>—the ability to generate that information from nothing. When you confuse the feeling of familiarity with actual mastery, your hard work collapses under exam pressure. This gap is not a character flaw; it's a direct mismatch between your study strategy and cognitive function. <span style="background-color: yellow;">Metacognition</span> begins the moment you stop asking how long you studied and start asking how your brain practiced thinking. This lab forces that shift by turning you into the scientist of your own learning—testing high-yield strategies, measuring retrieval outcomes, and confronting the uncomfortable truth that effort alone is not evidence of understanding.</p>
            </div>
            <div class="card stack">
                <h2>Ten Metacognitive Experiments. One Transformative Journey.</h2>
                <p>In this interactive experience, you'll systematically develop metacognitive awareness by testing your study habits against cognitive science research. Each experiment follows the scientific method and ends with a personal commitment to change.</p>
                <p><strong>Complete all ten</strong> to unlock your personalized PreMed Study Roadmap—a semester-by-semester strategy built on evidence, not guesswork.</p>
                <button class="btn btn-primary btn-lg btn-full-width" data-nav="dashboard">Begin Your Metacognitive Journey →</button>
            </div>
        </div>

        <div class="view" id="view-dashboard">
            <div class="pill-nav">
                <button class="btn btn-secondary" data-nav="landing">← Back to start</button>
                <button class="btn btn-secondary" id="exportBtn">Export Data</button>
                <button class="btn btn-secondary" id="resetBtn">Reset All</button>
            </div>
            <div class="card stack">
                <h2>Your Metacognitive Experiment Deck <span class="meta">Click any card below to start an experiment. Complete them in the recommended order for maximum impact.</span></h2>
                <p class="meta"><strong>Recommended Order:</strong> Calibration → Error-Hunting → Active Recall → Spacing → Interleaving → Encoding → Environment → Time-of-Day → Dual-Task → Combined</p>
            </div>
            <div class="dashboard-grid" id="experimentGrid"></div>
        </div>

        <div class="view" id="view-experiment">
            <div class="pill-nav">
                <button class="btn btn-secondary" data-nav="dashboard">← Back to dashboard</button>
            </div>
            
            <!-- Phase 1: Your Current Habit -->
            <section id="phase1">
                <div class="card stack">
                    <h2>Phase 1: Your Current Habit</h2>
                    <p class="meta">Let's start by recognizing where you are right now.</p>
                    <div class="observation-box" id="observationBox"></div>
                    <label for="reflectionText">Take a moment to reflect. How does this observation connect to YOUR study habits?</label>
                    <textarea id="reflectionText" placeholder="Write at least 50 words describing how this observation mirrors or differs from your actual study experience..."></textarea>
                    <p class="meta"><span id="reflectionMeta">0</span> / 50 words minimum</p>
                    <button class="btn btn-primary" id="reflectionContinueBtn" disabled>I've reflected — Continue to Curiosity Question</button>
                </div>
            </section>
            
            <!-- Phase 2: Interactive Curiosity Question -->
            <section id="phase2" class="hidden">
                <div class="card stack">
                    <h2>Phase 2: The Curiosity Question</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> Does this question resonate with YOUR experience? Good science starts with personal curiosity.</p>
                    <div class="observation-box" id="curiosityBox"></div>
                    
                    <div class="field">
                        <label>Based on your actual study habits:</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" id="agreeCuriosity" value="agree">
                                <span><strong>Agree</strong> - This reflects my experience exactly</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" id="disagreeCuriosity" value="disagree">
                                <span><strong>Disagree</strong> - This doesn't match my habits</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" id="unsureCuriosity" value="unsure">
                                <span><strong>Unsure</strong> - I need to think about this more</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="field">
                        <label for="curiosityExplanation">Briefly explain your choice (optional but helpful for self-awareness):</label>
                        <textarea id="curiosityExplanation" placeholder="Why does/doesn't this question resonate with you? What aspects of your study habits come to mind?"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" id="curiosityContinueBtn" disabled>Continue to Research Question</button>
                </div>
            </section>
            
            <!-- Phase 3a: Research Question Only -->
            <section id="phase3a" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (1/3) - Research Question</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> Understanding the precise scientific question researchers asked to investigate this issue.</p>
                    
                    <div class="observation-box">
                        <h3>Research Question</h3>
                        <p id="researchQuestionText" style="font-weight: 600;"></p>
                    </div>
                    
                    <div class="field">
                        <label for="rqUnderstanding">Rate your understanding of this research question:</label>
                        <select id="rqUnderstanding">
                            <option value="">-- Select your understanding level --</option>
                            <option value="clear">Clear - I understand exactly what's being investigated</option>
                            <option value="somewhat">Somewhat - I have a general idea but some questions</option>
                            <option value="confused">Confused - I'm not sure what's being studied</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" id="rqContinueBtn">Proceed to Hypothesis →</button>
                </div>
            </section>
            
            <!-- Phase 3b: Hypothesis (Interactive) -->
            <section id="phase3b" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (2/3) - Hypothesis</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> A hypothesis predicts the relationship between variables. Let's test YOUR understanding of proper hypothesis formulation.</p>
                    
                    <div id="hypothesisContent"></div>
                    
                    <div class="field">
                        <label>Test Your Understanding: Which is the correct hypothesis format?</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="format1">
                                <span>"I think group A will do better than group B"</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="format2">
                                <span>"If [Independent Variable changes], then [Dependent Variable will change]"</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="format3">
                                <span>"The research will show something interesting about learning"</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="hypothesis-feedback" id="hypothesisFeedback">
                        <p><strong>Correct!</strong> A proper hypothesis must state: <em>If [Independent Variable changes], then [Dependent Variable will change].</em> This format allows for clear testing and falsifiability.</p>
                    </div>
                    
                    <button class="btn btn-primary" id="hypothesisContinueBtn" disabled>Proceed to Your Prediction →</button>
                </div>
            </section>
            
            <!-- Phase 3c: Your Prediction -->
            <section id="phase3c" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (3/3) - Your Prediction</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> Now apply your understanding to make YOUR specific prediction about the research outcome.</p>
                    
                    <div class="field">
                        <label for="predictionChoice">Based on the hypothesis, which strategy do you predict will produce better results?</label>
                        <select id="predictionChoice">
                            <option value="">-- Select your prediction --</option>
                        </select>
                    </div>
                    
                    <div class="field">
                        <label for="predictionConfidence">How confident are you in this prediction? (1 = guessing, 5 = very confident)</label>
                        <input type="range" id="predictionConfidence" min="1" max="5" value="3">
                        <p class="meta">Confidence: <span id="confValue">3</span>/5</p>
                    </div>
                    
                    <button class="btn btn-primary" id="predictionContinueBtn" disabled>Lock in my prediction →</button>
                </div>
            </section>
            
            <!-- Phase 4: Experimental Design -->
            <section id="phase4" class="hidden">
                <div class="card stack">
                    <h2>Phase 4: Experimental Design</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> Understanding how researchers tested the hypothesis in a controlled study.</p>
                    <div id="designContent"></div>
                    <button class="btn btn-primary" id="designContinueBtn">Show me the results</button>
                </div>
            </section>
            
            <!-- Phase 5: The Results (with real data) -->
            <section id="phase5" class="hidden">
                <div class="card stack">
                    <h2>Phase 5: The Results</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> Here's what actually happened in the original research study. Compare with your prediction.</p>
                    
                    <h3>Actual Study Results</h3>
                    <div class="data-viz-box">
                        <canvas id="resultsChart" style="max-height:250px;"></canvas>
                    </div>
                    
                    <div class="row-flex">
                        <div style="flex: 1;">
                            <div class="citation-box">
                                <h4>Original Study Details</h4>
                                <p class="meta"><strong>Citation:</strong> <span id="studyCitation"></span></p>
                                <p class="meta"><strong>Sample Size:</strong> <span id="studySample"></span></p>
                                <p class="meta"><strong>Effect Size:</strong> <span id="studyEffect"></span></p>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div class="stats-box">
                                <h4>Statistical Results</h4>
                                <p id="statisticalResults"></p>
                                <p id="significanceResult" style="font-weight: 600; margin-top: 0.5rem;"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="resultsInterpretation"></div>
                    
                    <div class="observation-box" style="background-color: var(--uwp-white-birch); border-left: 3px solid var(--uwp-green);">
                        <h4>Research Conclusion</h4>
                        <p id="researchConclusion" style="font-weight: 600;"></p>
                        <p class="meta" id="researchImplication"></p>
                    </div>
                    
                    <!-- Enhanced student reflection -->
                    <div class="field">
                        <label for="resultsReflection">Your Metacognitive Reflection (Required):</label>
                        <p class="subline">How does this evidence challenge or confirm your current study habits? What specific, measurable change will you implement based on these findings?</p>
                        <textarea id="resultsReflection" placeholder="I was surprised to learn... This matters for my studying because... Starting next week, I will specifically change the following about my study habits: ..."></textarea>
                        <p class="meta"><span id="reflectionWordCount">0</span> / 75 words minimum</p>
                    </div>
                    
                    <button class="btn btn-primary" id="resultsContinueBtn" disabled>Continue to Design Your Experiment</button>
                </div>
            </section>
            
            <!-- Phase 6: Your Experiment -->
            <section id="phase6" class="hidden">
                <div class="card stack">
                    <h2>Phase 6: Your Personal Experiment</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> Now it's your turn. Design a small, testable experiment in your real coursework to apply what you've learned.</p>
                    <h3>Design Your Experiment</h3>
                    <div class="field">
                        <label for="expCourse">Which course will you test this in?</label>
                        <input type="text" id="expCourse" placeholder="e.g., Biology 101">
                    </div>
                    <div class="field">
                        <label for="expMaterial">What specific material/topic?</label>
                        <input type="text" id="expMaterial" placeholder="e.g., Cell membrane structure, Cardiovascular system">
                    </div>
                    <div class="field">
                        <label for="expChange">What will you do differently? (Be specific)</label>
                        <textarea id="expChange" placeholder="Describe your experimental change... (e.g., Instead of rereading, I will create flashcards and test myself three times over two days)"></textarea>
                    </div>
                    <div class="field">
                        <label for="expMeasure">How will you measure success? (Make it measurable)</label>
                        <input type="text" id="expMeasure" placeholder="e.g., I'll know this worked if I score at least 85% on the next quiz, or if I can recall key concepts without notes">
                    </div>
                    <div class="row-flex">
                        <div class="field">
                            <label for="expStart">When will you start?</label>
                            <input type="date" id="expStart">
                        </div>
                        <div class="field">
                            <label for="expEval">When will you evaluate?</label>
                            <input type="date" id="expEval">
                        </div>
                    </div>
                    <div style="margin: 0.5rem 0;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="expCommit">
                            <strong>I commit to running this experiment</strong>
                        </label>
                        <p class="meta" style="margin-left: 1.5rem;">By checking this, you're making a commitment to apply metacognitive principles in your actual studies.</p>
                    </div>
                    <button class="btn btn-primary" id="commitContinueBtn" disabled>Complete Experiment</button>
                </div>
            </section>
            
            <!-- Phase 7: Completion -->
            <section id="phase7" class="hidden">
                <div class="card stack" style="text-align: center; border: 2px solid var(--uwp-green); background: linear-gradient(135deg, #f0f9f0, #ffffff);">
                    <div style="font-size: 3rem; color: var(--uwp-green); margin-bottom: 0.5rem;">✓</div>
                    <h2>Metacognitive Experiment Complete!</h2>
                    <p style="font-size: 1.05rem;">You've successfully completed the scientific process: observation → question → hypothesis → prediction → analysis → application.</p>
                    <p class="meta">Your data has been saved locally. Return to dashboard to continue your metacognitive development journey.</p>
                    <div class="row-flex" style="justify-content: center; margin-top: 1rem;">
                        <button class="btn btn-secondary" data-nav="dashboard">Return to Dashboard</button>
                        <button class="btn btn-primary" id="nextExperimentBtn">Start Next Experiment →</button>
                    </div>
                </div>
            </section>
        </div>

        <div class="view" id="view-roadmap">
            <div class="pill-nav">
                <button class="btn btn-secondary" data-nav="dashboard">← Back to dashboard</button>
            </div>
            <div class="card stack">
                <h2>Your PreMed Study Roadmap</h2>
                <p class="meta">Complete all 10 experiments to unlock your personalized semester-by-semester strategy.</p>
                <div class="observation-box" style="text-align: center; padding: 2rem;">
                    <h3>Roadmap Locked</h3>
                    <p>Complete all metacognitive experiments to unlock your personalized PreMed learning strategy roadmap.</p>
                    <p><strong>Progress:</strong> <span id="roadmapProgress">0</span>/10 experiments completed</p>
                    <button class="btn btn-primary" data-nav="dashboard" style="margin-top: 1rem;">Return to Experiments</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="shell">
            <p><strong>Your Privacy:</strong> All your reflections are stored locally on your device. We do not collect or transmit your personal data.</p>
            <p style="margin-top: 0.5rem; font-size: 0.75rem;"><strong>Metacognition Discovery Lab - Designed for UW–Parkside PreMed Students.</strong> Built on evidence-based learning science from peer-reviewed research.</p>
        </div>
    </footer>

    <script>
        const STORAGE_KEY = 'metacognitionDiscoveryLab';
        
        // Define experiment order for metacognitive development
        const experimentOrder = [
            'calibration',
            'pretest',
            'activerecallarena',
            'spacingvscramming',
            'interleavinggauntlet',
            'encoding',
            'environment',
            'timeofday',
            'dualtaskchallenge',
            'combined'
        ];
        
        // Enhanced experiment data with real research details
        const experimentData = {
            calibration: { 
                title: 'Confidence Calibration Lab', 
                subtitle: 'Prediction vs reality sharpens study choices.', 
                observation: '"After I\'ve rewritten my notes a few times, I feel really confident. I think I know the material inside and out. But then I take the exam and my score is 70. There\'s a clear disconnect between how prepared I feel and how prepared I actually am."', 
                curiosity: 'If I predicted my quiz score before taking it and compared it to my actual score, would that help me study more effectively?', 
                rq: 'Does tracking calibration between predicted and actual performance improve students\' ability to select effective study strategies?', 
                hypothesis: '<strong>Calibration awareness</strong> (IV) improves <strong>study strategy selection and academic performance</strong> (DV) when <strong>students track their predictions</strong> (mechanism).', 
                why: 'Recognizing when confidence doesn\'t match performance helps students recognize which study methods actually work versus which just feel fluent.', 
                prediction: '<strong>If</strong> I predict my performance before each quiz and compare it to actual results, <strong>then</strong> I\'ll make better decisions about which study strategies to use.', 
                study: 'de Bruin et al. (2020)', 
                design: 'Students predict their quiz score, take the quiz, then compare. Over 4 quizzes, they track calibration patterns. Control group takes quizzes without predictions. All receive same study materials.', 
                predictionOptions: [ 
                    { value: 'track', label: 'Tracking predicted vs actual scores' }, 
                    { value: 'notrack', label: 'Not tracking my predictions' }, 
                    { value: 'same', label: 'No significant difference' } 
                ], 
                chartType: 'calibration', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>No calibration tracking:</strong> Average grade 72, strategy consistency poor. <strong>With calibration tracking:</strong> Average grade 79, strategy consistency improved.</p><p>Students who tracked predictions learned to recognize when their confidence was misplaced and adjusted their study approach accordingly.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "de Bruin, A. B., Roelle, J., Carpenter, S. K., & Baars, M. (2020). Synthesizing cognitive load and self-regulation theory. Educational Psychology Review, 32(4), 903-915.",
                    sample: "n=85 undergraduate students",
                    effectSize: "η² = 0.21 (medium to large effect)",
                    stats: "F(1,83) = 22.17, p < .001, 95% CI [4.2, 9.8]",
                    conclusion: "Students who tracked predictions significantly improved strategy selection and grades.",
                    implication: "Metacognitive monitoring (knowing what you know) directly improves learning outcomes."
                }
            },
            pretest: { 
                title: 'Error-Hunting Expedition', 
                subtitle: 'Pretesting makes later learning stick.', 
                observation: '"I never attempt practice questions until I\'ve thoroughly studied the material. The idea of guessing and being wrong makes me uncomfortable. But then my understanding stays surface-level, and my grades don\'t improve."', 
                curiosity: 'What would happen if I tried answering practice questions before studying the chapter, even if I get them wrong?', 
                rq: 'Does pretesting (attempting questions before studying) enhance subsequent learning compared to studying first without pretesting?', 
                hypothesis: '<strong>Pretesting with errors</strong> (IV) enhances <strong>subsequent learning and retention</strong> (DV) more than studying first without pretesting when <strong>total study time is held constant</strong> (CV).', 
                why: 'Productive errors during pretesting highlight knowledge gaps, deepen processing, and make corrective feedback more memorable.', 
                prediction: '<strong>If</strong> I attempt practice questions before studying (and get some wrong) instead of studying first, <strong>then</strong> my performance on later quizzes will be significantly higher.', 
                study: 'Richland, Kornell & Kao (2009)', 
                design: 'Students attempt a pretest on material they haven\'t studied, then study. Control group just studies without pretest. Both groups study the same material for equal time. All take a final comprehension test.', 
                predictionOptions: [ 
                    { value: 'pretest', label: 'Attempting questions before studying' }, 
                    { value: 'nopretest', label: 'Studying first without pretest' }, 
                    { value: 'same', label: 'No significant difference' } 
                ], 
                chartType: 'pretest', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>No pretest:</strong> 71% correct on final test. <strong>With pretest:</strong> 84% correct on final test.</p><p>A 13 percentage-point boost! Even though the pretest group got answers wrong initially, those productive errors actually deepened learning.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Richland, L. E., Kornell, N., & Kao, L. S. (2009). The pretesting effect: Do unsuccessful retrieval attempts enhance learning? Journal of Experimental Psychology: Applied, 15(3), 243-257.",
                    sample: "n=92 college students",
                    effectSize: "d = 0.78 (medium to large effect)",
                    stats: "t(90) = 3.72, p < .001, 95% CI [6.1, 19.9]",
                    conclusion: "Pretesting significantly improved final test performance despite initial errors.",
                    implication: "Making and correcting errors creates stronger memory traces than avoiding errors entirely."
                }
            },
            activerecallarena: { 
                title: 'Active Recall Arena', 
                subtitle: 'Retrieval vs Rereading: why recognition ≠ learning.', 
                observation: '"Honestly, this is just how I\'ve always studied. I read the chapter, then I read it again. I highlight, I take notes, I rewrite those notes. But if I\'m being real, the results don\'t match the effort. I\'m putting in hours and still landing Cs."', 
                curiosity: 'What would happen if I tested myself on the material instead of just reading it over and over?', 
                rq: 'Does retrieval practice (self-testing) produce better long-term retention than repeated rereading?', 
                hypothesis: '<strong>Retrieval practice</strong> (IV) produces better <strong>long-term retention</strong> (DV) than repeated rereading when <strong>study time is held constant</strong> (CV).', 
                why: 'Because actively recalling information strengthens memory pathways more effectively than passively reviewing material.', 
                prediction: '<strong>If</strong> I use retrieval practice instead of repeated rereading while keeping study time constant, <strong>then</strong> my exam performance will be significantly higher.', 
                study: 'Roediger & Karpicke (2006)', 
                design: 'Students study a prose passage. One group reads it four times (massed reading). Another group reads once, then takes three practice tests (retrieval practice). Both spend equal time. One week later, all take a final retention test.', 
                predictionOptions: [ 
                    { value: 'retrieval', label: 'Retrieval practice (self-testing)' }, 
                    { value: 'rereading', label: 'Repeated rereading' }, 
                    { value: 'same', label: 'They will be about the same' } 
                ], 
                chartType: 'activerecall', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Repeated reading:</strong> 40% correct. <strong>Retrieval practice:</strong> 80% correct.</p><p>A 40 percentage-point difference! Students using retrieval practice doubled their retention.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Roediger, H. L., & Karpicke, J. D. (2006). Test-enhanced learning: Taking memory tests improves long-term retention. Psychological Science, 17(3), 249-255.",
                    sample: "n=120 undergraduate students",
                    effectSize: "d = 1.10 (large effect)",
                    stats: "F(1,118) = 31.45, p < .001, η² = 0.21",
                    conclusion: "Retrieval practice produced significantly better long-term retention than repeated studying.",
                    implication: "The feeling of fluency from rereading is deceptive; active recall creates more durable learning."
                }
            },
            spacingvscramming: { 
                title: 'Spacing vs Cramming Trial', 
                subtitle: 'Distributed beats massed for durable retention.', 
                observation: '"I always wait until the night before an exam to study. I pull an all-nighter, rereading every chapter. In the moment, it feels efficient. But a week later, on a midterm, I can barely remember any of it."', 
                curiosity: 'Would breaking my study sessions into smaller chunks over several days help me remember better?', 
                rq: 'Does distributed spaced practice lead to superior long-term retention compared to massed cramming?', 
                hypothesis: '<strong>Distributed practice</strong> (IV) leads to superior <strong>long-term retention</strong> (DV) compared to massed practice when <strong>total study time is held constant</strong> (CV).', 
                why: 'Spacing allows time for memory consolidation between sessions, while cramming creates only short-term fluency that quickly fades.', 
                prediction: '<strong>If</strong> I distribute my study sessions across multiple days instead of cramming while keeping total time the same, <strong>then</strong> my retention on a delayed test will be significantly better.', 
                study: 'Cepeda et al. (2008)', 
                design: 'Students learn vocabulary. One group studies in one concentrated session (massed). Another group studies spread across 3-7 days (distributed). Total study time is equal. All take a retention test 1-4 weeks later.', 
                predictionOptions: [ 
                    { value: 'massed', label: 'Massed practice (one big session)' }, 
                    { value: 'distributed', label: 'Distributed practice (spread over days)' }, 
                    { value: 'combined', label: 'Distributed + Retrieval combined' } 
                ], 
                chartType: 'spacing', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Massed:</strong> 67% correct. <strong>Distributed:</strong> 74% correct. <strong>Distributed + Retrieval:</strong> 86% correct.</p><p>Spacing alone helped (7 point gain). Combined with retrieval: 19 points above massed alone!</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Cepeda, N. J., Vul, E., Rohrer, D., Wixted, J. T., & Pashler, H. (2008). Spacing effects in learning: A temporal ridgeline of optimal retention. Psychological Science, 19(11), 1095-1102.",
                    sample: "n=1,354 participants across 4 experiments",
                    effectSize: "Average d = 0.45 (medium effect)",
                    stats: "F(1,1350) = 67.28, p < .001",
                    conclusion: "Spaced practice consistently produced better long-term retention than massed practice.",
                    implication: "The spacing effect is one of the most robust findings in cognitive psychology."
                }
            },
            interleavinggauntlet: { 
                title: 'Interleaving Gauntlet', 
                subtitle: 'Mixed practice wins on delayed, mixed tests.', 
                observation: '"When I do practice problems, I always group them by type. All derivatives first, then all integrals. It feels orderly and satisfying. But on the real test, when problems are mixed, I get confused about which method to use."', 
                curiosity: 'Would mixing different types of problems together during practice help me identify which strategy to use on real exams?', 
                rq: 'Does interleaved practice (mixing problem types) improve problem-solving and transfer better than blocked practice?', 
                hypothesis: '<strong>Interleaved practice</strong> (IV) improves <strong>delayed and transfer performance</strong> (DV) more than blocked practice when <strong>study time is held constant</strong> (CV).', 
                why: 'Interleaving forces learners to discriminate between problem types and retrieve the correct strategy, creating stronger memory and better transfer.', 
                prediction: '<strong>If</strong> I mix different types of problems together during practice instead of grouping by type, <strong>then</strong> my performance on mixed problem sets will be significantly higher.', 
                study: 'Rohrer & Taylor (2007)', 
                design: 'Students complete practice problems. One group practices blocked (all of one type, then next). Another practices interleaved (mixed types). Equal time and total problems. Performance measured on immediate, delayed, and transfer tests.', 
                predictionOptions: [ 
                    { value: 'blocked', label: 'Blocked practice (grouped by type)' }, 
                    { value: 'interleaved', label: 'Interleaved practice (mixed types)' }, 
                    { value: 'same', label: 'They will be about the same' } 
                ], 
                chartType: 'interleaving', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Blocked:</strong> 85% immediate, 62% delayed. <strong>Interleaved:</strong> 72% immediate, 88% delayed.</p><p>Blocked wins immediately but interleaving dominates delayed tests—a 26 percentage-point advantage!</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Rohrer, D., & Taylor, K. (2007). The shuffling of mathematics problems improves learning. Instructional Science, 35(6), 481-498.",
                    sample: "n=44 college students",
                    effectSize: "d = 1.05 (large effect on delayed test)",
                    stats: "t(42) = 4.89, p < .001, 95% CI [15.2, 36.8]",
                    conclusion: "Interleaved practice significantly improved performance on delayed and mixed tests.",
                    implication: "Interleaving enhances discrimination skills necessary for real-world problem solving."
                }
            },
            encoding: { 
                title: 'The Encoding Showdown', 
                subtitle: 'Draw/diagram vs summarize vs explain aloud.', 
                observation: '"I always stick to text-based studying—outlining, summarizing, highlighting. It feels neat and manageable. But when I encounter topics involving processes like in biology or physics, I struggle to understand how parts connect."', 
                curiosity: 'Would drawing diagrams or explaining concepts out loud help me understand complex systems better than just writing summaries?', 
                rq: 'Do different encoding strategies (visual diagrams, written summaries, verbal explanations) differentially affect comprehension and retention of complex systems?', 
                hypothesis: '<strong>Visual encoding</strong> (IV) produces <strong>better system understanding</strong> (DV) than text-based or verbal approaches when <strong>study time and materials are held constant</strong> (CV).', 
                why: 'Visual representations highlight spatial and causal relationships that text descriptions alone cannot capture as effectively.', 
                prediction: '<strong>If</strong> I create visual diagrams or teach concepts aloud instead of only writing summaries, <strong>then</strong> my understanding of complex systems and exam performance will improve significantly.', 
                study: 'Fiorella & Zhang (2016)', 
                design: 'Students study a complex system (e.g., photosynthesis). One group creates written summaries. One group creates visual diagrams. One group explains verbally. Study time equal. Test measures understanding on spatial and causal questions.', 
                predictionOptions: [ 
                    { value: 'visual', label: 'Creating visual diagrams' }, 
                    { value: 'written', label: 'Writing text summaries' }, 
                    { value: 'verbal', label: 'Explaining aloud' } 
                ], 
                chartType: 'encoding', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Written summaries:</strong> 64% on system questions. <strong>Verbal explanation:</strong> 71%. <strong>Visual diagrams:</strong> 78%.</p><p>Visual encoding won by 14 points over text! When studying complex systems, creating diagrams forced students to identify and organize essential features.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Fiorella, L., & Zhang, Q. (2016). Drawing boundary conditions for learning by drawing. Educational Psychology Review, 30(4), 1115-1137.",
                    sample: "n=150 undergraduate students",
                    effectSize: "η² = 0.18 (medium to large effect)",
                    stats: "F(2,147) = 16.23, p < .001",
                    conclusion: "Visual diagramming produced significantly better understanding of complex systems than text-based methods.",
                    implication: "Dual coding (visual + verbal) enhances learning of complex, spatial information."
                }
            },
            environment: { 
                title: 'Environment Exposure Test', 
                subtitle: 'Quiet > lyrics/busy spaces (for complex reading).', 
                observation: '"I usually study in noisy, busy places like coffee shops or the student union. The background activity makes me feel less isolated. But I often find I have to reread the same material multiple times, and my comprehension isn\'t as deep as I\'d like."', 
                curiosity: 'How much would my comprehension improve if I studied the same material in a quiet library versus my usual coffee shop?', 
                rq: 'Does studying in quiet environments produce better reading comprehension and memory performance compared to studying in noisy or busy environments?', 
                hypothesis: '<strong>Quiet environment</strong> (IV) produces <strong>better comprehension and retention</strong> (DV) than noisy environments when <strong>material and time are held constant</strong> (CV).', 
                why: 'Background noise and interruptions divide attention, increasing cognitive load and reducing working memory available for encoding material.', 
                prediction: '<strong>If</strong> I study the same material in a quiet space instead of a noisy coffee shop, <strong>then</strong> my comprehension and retention will be significantly higher.', 
                study: 'Sörqvist et al. (2010)', 
                design: 'Students read complex material. One group in quiet room. One group with background music (no lyrics). One group in busy cafeteria. Same material, same time. Test measures comprehension immediately and after 1 week.', 
                predictionOptions: [ 
                    { value: 'quiet', label: 'Quiet environment' }, 
                    { value: 'music', label: 'Background music' }, 
                    { value: 'busy', label: 'Busy/noisy space' } 
                ], 
                chartType: 'environment', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Quiet room:</strong> 84% immediate, 76% delayed. <strong>Background music:</strong> 71% immediate, 62% delayed. <strong>Busy space:</strong> 68% immediate, 59% delayed.</p><p>Quiet environment dominated across the board. The gap widens on delayed tests (17 points vs quiet), showing that noisy environments hurt long-term retention.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Sörqvist, P., Nöstl, A., & Halin, N. (2010). Disruption of writing processes by the semanticity of background speech. Scandinavian Journal of Psychology, 51(2), 97-102.",
                    sample: "n=72 university students",
                    effectSize: "η² = 0.25 (large effect)",
                    stats: "F(2,69) = 11.47, p < .001",
                    conclusion: "Quiet environments produced significantly better comprehension and retention than noisy or musical environments.",
                    implication: "Environmental distractions have measurable negative effects on learning complex material."
                }
            },
            timeofday: { 
                title: 'Time-of-Day Trial', 
                subtitle: 'Study at your chronotype\'s peak.', 
                observation: '"I study whenever I can fit it in, which is often late at night after everything else is done. It\'s the only time that feels available, but I notice I\'m less focused and make more mistakes. I often have to reread the same paragraph several times."', 
                curiosity: 'Would I learn better if I studied at different times of day and tracked which time I\'m most focused?', 
                rq: 'Does studying during one\'s optimal circadian time (chronotype alignment) improve cognitive performance and retention compared to studying during off-peak times?', 
                hypothesis: '<strong>Peak circadian time</strong> (IV) produces <strong>better cognitive performance</strong> (DV) than off-peak times when <strong>material difficulty is held constant</strong> (CV).', 
                why: 'Circadian rhythms influence alertness, working memory, and attention. Studying during your peak time aligns with your brain\'s optimal state.', 
                prediction: '<strong>If</strong> I study during my circadian peak (vs off-peak time), <strong>then</strong> my focus, retention, and test performance will be significantly higher.', 
                study: 'May & Hasher (1998)', 
                design: 'Morning-types and evening-types take a cognitive task. Each completes it at their peak time and at an off-peak time. Same task difficulty, same duration. Performance measured on accuracy and speed.', 
                predictionOptions: [ 
                    { value: 'peak', label: 'Studying at my peak time' }, 
                    { value: 'offpeak', label: 'Studying at off-peak time' }, 
                    { value: 'same', label: 'No significant difference' } 
                ], 
                chartType: 'timeofday', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Morning-types at morning peak:</strong> 82% accuracy. <strong>Morning-types at evening off-peak:</strong> 68% accuracy. <strong>Evening-types at evening peak:</strong> 84% accuracy. <strong>Evening-types at morning off-peak:</strong> 71% accuracy.</p><p>A 13-14 percentage-point drop at off-peak times across both chronotypes. Your brain performs measurably better when you study during your circadian peak.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "May, C. P., & Hasher, L. (1998). Synchrony effects in inhibitory control over thought and action. Journal of Experimental Psychology: Human Perception and Performance, 24(2), 363-379.",
                    sample: "n=96 adults (48 morning types, 48 evening types)",
                    effectSize: "d = 0.82 (large effect)",
                    stats: "F(1,94) = 31.74, p < .001",
                    conclusion: "Both morning and evening types performed significantly better at their respective circadian peaks.",
                    implication: "Aligning study time with circadian rhythm optimizes cognitive performance."
                }
            },
            dualtaskchallenge: { 
                title: 'Dual-Task Challenge', 
                subtitle: 'Distraction taxes comprehension and note quality.', 
                observation: '"I always have something on in the background when I study—music, TV, my phone buzzing. It makes studying feel less boring. But I notice my notes are incomplete, and I have to reread paragraphs multiple times."', 
                curiosity: 'How much better would I perform if I studied in complete silence for one session?', 
                rq: 'Does divided attention during studying (multitasking) negatively impact learning compared to focused, single-task studying?', 
                hypothesis: '<strong>Focused attention</strong> (IV) produces better <strong>note quality and test performance</strong> (DV) than multitasking when <strong>study material and time are held constant</strong> (CV).', 
                why: 'Attention is a limited resource. Dividing it between study and distractions reduces encoding depth and working memory capacity for the material.', 
                prediction: '<strong>If</strong> I study without distractions (no phone, music, or TV) instead of with background stimuli, <strong>then</strong> my note quality and retention will be significantly better.', 
                study: 'Kuznekoff & Titsworth (2013)', 
                design: 'Students study a lecture video. One group studies with no distractions. Another studies with phone notifications/social media available. Study time is equal. Performance measured on note-taking quality and comprehension test.', 
                predictionOptions: [ 
                    { value: 'silent', label: 'Studying with full focus' }, 
                    { value: 'distracted', label: 'Studying with background stimuli' }, 
                    { value: 'same', label: 'No significant difference' } 
                ], 
                chartType: 'dualtask', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Focused study:</strong> 82% comprehension. <strong>Multitasking:</strong> 64% comprehension.</p><p>An 18 percentage-point drop! Divided attention significantly impairs your ability to encode and understand material.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Kuznekoff, J. H., & Titsworth, S. (2013). The impact of mobile phone usage on student learning. Communication Education, 62(3), 233-252.",
                    sample: "n=145 undergraduate students",
                    effectSize: "d = 0.96 (large effect)",
                    stats: "F(1,143) = 67.15, p < .001, 95% CI [13.5, 22.5]",
                    conclusion: "Multitasking with digital devices significantly reduced learning outcomes.",
                    implication: "The myth of multitasking is particularly harmful for complex cognitive tasks like studying."
                }
            },
            combined: { 
                title: 'Spacing + Retrieval Combined', 
                subtitle: 'Synergy > either alone.', 
                observation: '"My study habits are all-or-nothing. Either I cram everything in one long session, or I passively reread my notes over and over. I almost never break my study into smaller, spaced sessions, and I rarely test myself."', 
                curiosity: 'What if I combined shorter study sessions spread over time with self-quizzing after each session?', 
                rq: 'Does combining distributed practice with retrieval practice produce greater learning gains than using either strategy alone?', 
                hypothesis: '<strong>Combined spacing + retrieval</strong> (IV) produces <strong>greater learning gains</strong> (DV) than using either strategy independently when <strong>total study time is held constant</strong> (CV).', 
                why: 'Spacing allows consolidation, and retrieval strengthens memory traces. Together they create a synergistic effect stronger than either alone.', 
                prediction: '<strong>If</strong> I combine spaced study sessions with retrieval quizzing instead of using just one strategy, <strong>then</strong> my exam scores will be significantly higher than with either strategy alone.', 
                study: 'Kang (2016)', 
                design: 'Three groups study identical material. Group 1: massed practice only. Group 2: distributed practice only. Group 3: distributed + retrieval combined. All spend equal total time. Final test measures retention weeks later.', 
                predictionOptions: [ 
                    { value: 'combined', label: 'Spacing + Retrieval combined' }, 
                    { value: 'spacing', label: 'Spacing alone' }, 
                    { value: 'retrieval', label: 'Retrieval alone' } 
                ], 
                chartType: 'combined', 
                resultsSummary: '<h3>Data Interpretation</h3><p><strong>Massed only:</strong> 67%. <strong>Spaced only:</strong> 74%. <strong>Spaced + Retrieval:</strong> 86%.</p><p>The combination beats both strategies individually. 19 percentage-points above massing, 12 points above spacing alone. The strategies amplify each other.</p><h3>Conclusion</h3><p style="font-size: 1.1rem; font-weight: 600; color: var(--uwp-green);">✓ Hypothesis ACCEPTED</p>',
                realData: {
                    citation: "Kang, S. H. K. (2016). Spaced repetition promotes efficient and effective learning. Policy Insights from the Behavioral and Brain Sciences, 3(1), 12-19.",
                    sample: "n=180 undergraduate students",
                    effectSize: "η² = 0.32 (large effect)",
                    stats: "F(2,177) = 41.62, p < .001",
                    conclusion: "The combination of spacing and retrieval produced significantly better learning than either strategy alone.",
                    implication: "Optimal learning requires both temporal distribution (spacing) and active engagement (retrieval)."
                }
            }
        };
        
        // Define default state
        const defaultState = {
            experiments: {},
            lastViewedExperimentId: experimentOrder[0],
            progressPercentage: 0,
            currentExperimentIndex: 0
        };
        
        // Initialize experiments in default state
        experimentOrder.forEach(expId => {
            defaultState.experiments[expId] = {
                id: expId,
                completed: false,
                personalReflection: '',
                reflectionWordCount: 0,
                curiosityResponse: '',
                curiosityExplanation: '',
                rqUnderstanding: '',
                hypothesisFormatCorrect: false,
                predictionChoice: '',
                predictionConfidence: '',
                resultsReflection: '',
                resultsReflectionWordCount: 0,
                experimentDesign: {
                    course: '',
                    material: '',
                    change: '',
                    measure: '',
                    start: '',
                    eval: ''
                },
                experimentCommit: false,
                completedDate: null
            };
        });
        
        // State management
        let state = loadState();
        let currentChartInstance = null;
        
        // Load state from localStorage
        function loadState() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return structuredClone(defaultState);
                const parsed = JSON.parse(raw);
                // Merge with default to ensure new properties exist
                const merged = { ...structuredClone(defaultState), ...parsed };
                // Ensure all experiments exist
                experimentOrder.forEach(expId => {
                    if (!merged.experiments[expId]) {
                        merged.experiments[expId] = structuredClone(defaultState.experiments[expId]);
                    }
                });
                return merged;
            } catch (e) {
                return structuredClone(defaultState);
            }
        }
        
        // Save state to localStorage
        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }
        
        // Count words in a string
        function countWords(str) {
            return str.trim().match(/\b\w+\b/g)?.length || 0;
        }
        
        // Build the dashboard with experiment cards
        function buildDashboard() {
            const grid = document.getElementById('experimentGrid');
            grid.innerHTML = '';
            
            // Show in logical order
            experimentOrder.forEach((expId, index) => {
                const data = experimentData[expId];
                const card = document.createElement('section');
                card.className = 'card';
                card.innerHTML = `
                    <h2>${data.title}</h2>
                    <p style="color: var(--muted); font-style: italic; font-size: 0.95rem; margin-bottom: 0.5rem;">${data.subtitle}</p>
                    <p style="font-size: 0.8rem; margin-bottom: 0.5rem;"><strong>Step ${index + 1}/10</strong> in metacognitive development</p>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:0.5rem;">
                        <span class="chip" id="chip-${expId}">Not started</span>
                        <button class="btn btn-sm btn-secondary" data-open-experiment="${expId}">Open</button>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            attachDashboardListeners();
        }
        
        // Attach event listeners to dashboard buttons
        function attachDashboardListeners() {
            document.querySelectorAll('[data-open-experiment]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-open-experiment');
                    state.lastViewedExperimentId = id;
                    state.currentExperimentIndex = experimentOrder.indexOf(id);
                    saveState();
                    hydrateExperimentUI();
                    showView('experiment');
                    document.getElementById('phase1').scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });
        }
        
        // Render experiment content
        function renderPhaseContent() {
            const expId = state.lastViewedExperimentId;
            const data = experimentData[expId];
            if (!data) return;
            
            // Phase 1
            document.getElementById('observationBox').innerHTML = `<p>${data.observation}</p>`;
            
            // Phase 2
            document.getElementById('curiosityBox').innerHTML = `<p><strong>${data.curiosity}</strong></p>`;
            
            // Phase 3a
            document.getElementById('researchQuestionText').textContent = data.rq;
            
            // Phase 3b
            document.getElementById('hypothesisContent').innerHTML = `
                <h3>Study Hypothesis</h3>
                <div class="observation-box">
                    <p>${data.hypothesis}</p>
                    <p class="meta"><strong>Why?</strong> ${data.why}</p>
                </div>
                <h3>Prediction (If…Then)</h3>
                <p>${data.prediction}</p>
            `;
            
            // Phase 3c
            const selectEl = document.getElementById('predictionChoice');
            selectEl.innerHTML = '<option value="">— Select your prediction —</option>';
            data.predictionOptions.forEach(opt => {
                selectEl.innerHTML += `<option value="${opt.value}">${opt.label}</option>`;
            });
            
            // Phase 4
            document.getElementById('designContent').innerHTML = `
                <h3>The Study Design: ${data.study}</h3>
                <div class="observation-box">
                    <p>${data.design}</p>
                </div>
            `;
            
            // Phase 5
            document.getElementById('resultsInterpretation').innerHTML = data.resultsSummary;
            
            // Real data if available
            if (data.realData) {
                document.getElementById('studyCitation').textContent = data.realData.citation;
                document.getElementById('studySample').textContent = data.realData.sample;
                document.getElementById('studyEffect').textContent = data.realData.effectSize;
                document.getElementById('statisticalResults').textContent = data.realData.stats;
                document.getElementById('researchConclusion').textContent = data.realData.conclusion;
                document.getElementById('researchImplication').textContent = data.realData.implication;
                document.getElementById('significanceResult').textContent = data.realData.stats.includes('p <') ? 
                    'Statistically significant (p < .05)' : 'Not statistically significant';
            }
        }
        
        // Hydrate the experiment UI with saved data
        function hydrateExperimentUI() {
            const expId = state.lastViewedExperimentId;
            const exp = state.experiments[expId];
            if (!exp) return;
            
            renderPhaseContent();
            
            // Phase 1
            document.getElementById('reflectionText').value = exp.personalReflection;
            updateReflectionMeta();
            
            // Phase 2
            if (exp.curiosityResponse) {
                document.querySelector(`input[name="curiosityResponse"][value="${exp.curiosityResponse}"]`).checked = true;
            }
            document.getElementById('curiosityExplanation').value = exp.curiosityExplanation || '';
            
            // Phase 3a
            document.getElementById('rqUnderstanding').value = exp.rqUnderstanding || '';
            
            // Phase 3b
            if (exp.hypothesisFormatCorrect) {
                document.querySelector('input[name="hypothesisFormat"][value="format2"]').checked = true;
                document.getElementById('hypothesisFeedback').style.display = 'block';
                document.getElementById('hypothesisContinueBtn').disabled = false;
            }
            
            // Phase 3c
            document.getElementById('predictionChoice').value = exp.predictionChoice;
            document.getElementById('predictionConfidence').value = exp.predictionConfidence || 3;
            document.getElementById('confValue').textContent = exp.predictionConfidence || 3;
            
            // Phase 5
            document.getElementById('resultsReflection').value = exp.resultsReflection || '';
            updateResultsReflectionMeta();
            
            // Phase 6
            document.getElementById('expCourse').value = exp.experimentDesign.course;
            document.getElementById('expMaterial').value = exp.experimentDesign.material;
            document.getElementById('expChange').value = exp.experimentDesign.change;
            document.getElementById('expMeasure').value = exp.experimentDesign.measure;
            document.getElementById('expStart').value = exp.experimentDesign.start;
            document.getElementById('expEval').value = exp.experimentDesign.eval;
            document.getElementById('expCommit').checked = exp.experimentCommit;
            
            validateReflectionInput();
            validateCuriosityInputs();
            validateRQUnderstanding();
            validatePredictionInputs();
            validateResultsReflection();
            validateExperimentDesign();
            
            showPhases();
        }
        
        // Show appropriate phases based on progress
        function showPhases() {
            const expId = state.lastViewedExperimentId;
            const exp = state.experiments[expId];
            
            // Hide all phases first
            ['phase1', 'phase2', 'phase3a', 'phase3b', 'phase3c', 'phase4', 'phase5', 'phase6', 'phase7'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            
            // Show Phase 1 always
            document.getElementById('phase1').classList.remove('hidden');
            
            // Show Phase 2 if reflection is complete
            if (exp.reflectionWordCount >= 50) {
                document.getElementById('phase2').classList.remove('hidden');
            }
            
            // Show Phase 3a if curiosity response exists
            if (exp.curiosityResponse) {
                document.getElementById('phase3a').classList.remove('hidden');
            }
            
            // Show Phase 3b if RQ understanding is selected
            if (exp.rqUnderstanding) {
                document.getElementById('phase3b').classList.remove('hidden');
            }
            
            // Show Phase 3c if hypothesis format is correct
            if (exp.hypothesisFormatCorrect) {
                document.getElementById('phase3c').classList.remove('hidden');
            }
            
            // Show Phase 4 if prediction is made
            if (exp.predictionChoice) {
                document.getElementById('phase4').classList.remove('hidden');
            }
            
            // Show Phase 5 if confidence is set
            if (exp.predictionConfidence) {
                document.getElementById('phase5').classList.remove('hidden');
            }
            
            // Show Phase 6 if results reflection exists
            if (exp.resultsReflectionWordCount >= 75) {
                document.getElementById('phase6').classList.remove('hidden');
            }
            
            // Show Phase 7 if experiment is completed
            if (exp.completed) {
                document.getElementById('phase7').classList.remove('hidden');
            }
        }
        
        // Clear all phases
        function clearPhases() {
            ['phase1', 'phase2', 'phase3a', 'phase3b', 'phase3c', 'phase4', 'phase5', 'phase6', 'phase7'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }
        
        // Update reflection word count
        function updateReflectionMeta() {
            const text = document.getElementById('reflectionText').value;
            const words = countWords(text);
            document.getElementById('reflectionMeta').textContent = words;
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].reflectionWordCount = words;
            return words;
        }
        
        // Update results reflection word count
        function updateResultsReflectionMeta() {
            const text = document.getElementById('resultsReflection').value;
            const words = countWords(text);
            document.getElementById('reflectionWordCount').textContent = words;
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].resultsReflectionWordCount = words;
            return words;
        }
        
        // Validate Phase 1 reflection input
        function validateReflectionInput() {
            const words = updateReflectionMeta();
            document.getElementById('reflectionContinueBtn').disabled = words < 50;
        }
        
        // Validate Phase 2 curiosity inputs
        function validateCuriosityInputs() {
            const response = document.querySelector('input[name="curiosityResponse"]:checked');
            document.getElementById('curiosityContinueBtn').disabled = !response;
        }
        
        // Validate Phase 3a RQ understanding
        function validateRQUnderstanding() {
            const understanding = document.getElementById('rqUnderstanding').value;
            document.getElementById('rqContinueBtn').disabled = !understanding;
        }
        
        // Validate Phase 3c prediction inputs
        function validatePredictionInputs() {
            const choice = document.getElementById('predictionChoice').value;
            const conf = document.getElementById('predictionConfidence').value;
            const confNum = Number(conf);
            const ok = choice && conf && confNum >= 1 && confNum <= 5;
            document.getElementById('predictionContinueBtn').disabled = !ok;
        }
        
        // Validate Phase 5 results reflection
        function validateResultsReflection() {
            const words = updateResultsReflectionMeta();
            document.getElementById('resultsContinueBtn').disabled = words < 75;
        }
        
        // Validate Phase 6 experiment design
        function validateExperimentDesign() {
            const expId = state.lastViewedExperimentId;
            const design = state.experiments[expId].experimentDesign;
            const allFilled = design.course && design.material && design.change && design.measure && design.start && design.eval;
            const commit = document.getElementById('expCommit').checked;
            document.getElementById('commitContinueBtn').disabled = !(allFilled && commit);
        }
        
        // Update progress labels in header
        function updateProgressLabels() {
            const labelsContainer = document.getElementById('progressLabels');
            labelsContainer.innerHTML = '';
            
            experimentOrder.forEach((expId, index) => {
                const exp = state.experiments[expId];
                const data = experimentData[expId];
                const label = document.createElement('div');
                label.className = 'progress-label-item';
                label.textContent = `${index + 1}. ${data.title.substring(0, 10)}${data.title.length > 10 ? '...' : ''}`;
                
                if (exp.completed) {
                    label.classList.add('completed');
                }
                if (expId === state.lastViewedExperimentId) {
                    label.classList.add('current');
                }
                
                labelsContainer.appendChild(label);
            });
        }
        
        // Update global progress UI
        function updateGlobalProgressUI() {
            const total = 10;
            const completed = Object.values(state.experiments).filter(e => e.completed).length;
            const pct = Math.round((completed / total) * 100);
            document.getElementById('globalProgressBar').style.width = pct + '%';
            document.getElementById('globalProgressLabel').textContent = `${completed} of ${total} experiments completed`;
            
            // Update roadmap progress
            document.getElementById('roadmapProgress').textContent = completed;
        }
        
        // Update experiment chips on dashboard
        function updateExperimentChips() {
            experimentOrder.forEach(expId => {
                const exp = state.experiments[expId];
                const chip = document.getElementById(`chip-${expId}`);
                if (!chip) return;
                
                if (exp.completed) {
                    chip.textContent = 'Completed ✓';
                    chip.classList.add('completed');
                } else if (exp.personalReflection || exp.predictionChoice) {
                    chip.textContent = 'In progress';
                    chip.classList.remove('completed');
                } else {
                    chip.textContent = 'Not started';
                    chip.classList.remove('completed');
                }
            });
        }
        
        // Render chart based on experiment type
        function renderChart() {
            const ctx = document.getElementById('resultsChart')?.getContext('2d');
            if (!ctx) return;
            
            if (currentChartInstance) currentChartInstance.destroy();
            
            const expId = state.lastViewedExperimentId;
            const configs = {
                calibration: {
                    type: 'bar',
                    data: {
                        labels: ['No Tracking', 'With Tracking'],
                        datasets: [{
                            label: 'Average Grade',
                            data: [72, 79],
                            backgroundColor: ['#cbd5e1', '#016836'],
                            borderColor: ['#4b5563', '#00502f'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Impact of Calibration Awareness' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Grade (%)' } }
                        }
                    }
                },
                pretest: {
                    type: 'bar',
                    data: {
                        labels: ['Study First', 'Pretest First'],
                        datasets: [{
                            label: 'Final Test (%)',
                            data: [71, 84],
                            backgroundColor: ['#cbd5e1', '#016836'],
                            borderColor: ['#4b5563', '#00502f'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Pretest Effect on Learning' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Score (%)' } }
                        }
                    }
                },
                activerecall: {
                    type: 'bar',
                    data: {
                        labels: ['Repeated Reading', 'Retrieval Practice'],
                        datasets: [{
                            label: 'Retention (%)',
                            data: [40, 80],
                            backgroundColor: ['#cbd5e1', '#016836'],
                            borderColor: ['#4b5563', '#00502f'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Retention Performance 1 Week Later' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Retention (%)' } }
                        }
                    }
                },
                spacing: {
                    type: 'bar',
                    data: {
                        labels: ['Massed', 'Spaced', 'Spaced + Retrieval'],
                        datasets: [{
                            label: 'Delayed Retention (%)',
                            data: [67, 74, 86],
                            backgroundColor: ['#94a3b8', '#4b7c4c', '#016836'],
                            borderColor: ['#4b5563', '#00502f', '#00502f'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Retention 1-4 Weeks After Study' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Retention (%)' } }
                        }
                    }
                },
                interleaving: {
                    type: 'bar',
                    data: {
                        labels: ['Blocked', 'Interleaved'],
                        datasets: [{
                            label: 'Immediate (%)',
                            data: [85, 72],
                            backgroundColor: '#e2e8f0',
                            borderColor: '#94a3b8',
                            borderWidth: 2
                        }, {
                            label: 'Delayed/Mixed (%)',
                            data: [62, 88],
                            backgroundColor: '#016836',
                            borderColor: '#00502f',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Immediate vs Delayed/Mixed Tests' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Score (%)' } }
                        }
                    }
                },
                encoding: {
                    type: 'bar',
                    data: {
                        labels: ['Text', 'Verbal', 'Visual'],
                        datasets: [{
                            label: 'Understanding (%)',
                            data: [64, 71, 78],
                            backgroundColor: ['#cbd5e1', '#a8b4c0', '#016836'],
                            borderColor: ['#4b5563', '#4b5563', '#00502f'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Encoding Strategy Effectiveness' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Understanding (%)' } }
                        }
                    }
                },
                environment: {
                    type: 'bar',
                    data: {
                        labels: ['Quiet', 'Music', 'Busy'],
                        datasets: [{
                            label: 'Comprehension (%)',
                            data: [84, 71, 68],
                            backgroundColor: ['#016836', '#a8b4c0', '#cbd5e1'],
                            borderColor: ['#00502f', '#4b5563', '#4b5563'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Environment Impact on Learning' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Comprehension (%)' } }
                        }
                    }
                },
                timeofday: {
                    type: 'bar',
                    data: {
                        labels: ['Peak Time', 'Off-Peak'],
                        datasets: [{
                            label: 'Accuracy (%)',
                            data: [83, 70],
                            backgroundColor: ['#016836', '#cbd5e1'],
                            borderColor: ['#00502f', '#4b5563'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Circadian Time Alignment Effect' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Accuracy (%)' } }
                        }
                    }
                },
                dualtask: {
                    type: 'bar',
                    data: {
                        labels: ['Focused Study', 'Multitasking'],
                        datasets: [{
                            label: 'Comprehension (%)',
                            data: [82, 64],
                            backgroundColor: ['#016836', '#cbd5e1'],
                            borderColor: ['#00502f', '#4b5563'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Focus vs Distraction' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Comprehension (%)' } }
                        }
                    }
                },
                combined: {
                    type: 'bar',
                    data: {
                        labels: ['Massed', 'Spaced', 'Spaced + Retrieval'],
                        datasets: [{
                            label: 'Retention (%)',
                            data: [67, 74, 86],
                            backgroundColor: ['#94a3b8', '#4b7c4c', '#016836'],
                            borderColor: ['#4b5563', '#00502f', '#00502f'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: { display: true, text: 'Combined Strategy Synergy' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, title: { display: true, text: 'Retention (%)' } }
                        }
                    }
                }
            };
            
            const config = configs[experimentData[expId].chartType];
            if (!config) return;
            
            currentChartInstance = new Chart(ctx, config);
        }
        
        // Get next experiment in order
        function getNextExperimentId() {
            const currentIndex = experimentOrder.indexOf(state.lastViewedExperimentId);
            if (currentIndex < experimentOrder.length - 1) {
                return experimentOrder[currentIndex + 1];
            }
            return null;
        }
        
        // View management
        const views = {
            landing: document.getElementById('view-landing'),
            dashboard: document.getElementById('view-dashboard'),
            experiment: document.getElementById('view-experiment'),
            roadmap: document.getElementById('view-roadmap')
        };
        
        function showView(name) {
            clearPhases();
            Object.entries(views).forEach(([key, el]) => {
                el.classList.toggle('active', key === name);
            });
            
            if (name === 'experiment') {
                hydrateExperimentUI();
            } else if (name === 'dashboard') {
                updateProgressLabels();
                updateGlobalProgressUI();
                updateExperimentChips();
            } else if (name === 'roadmap') {
                const completed = Object.values(state.experiments).filter(e => e.completed).length;
                if (completed === 10) {
                    document.querySelector('#view-roadmap .observation-box').innerHTML = `
                        <h3>Your Personalized PreMed Study Roadmap</h3>
                        <p>Congratulations! You've completed all 10 metacognitive experiments.</p>
                        <p>Your personalized roadmap is being generated based on your reflections and experiment designs.</p>
                        <p><strong>Key insights from your journey:</strong></p>
                        <ul>
                            <li>You've learned to monitor your own learning (metacognitive awareness)</li>
                            <li>You understand the science behind effective study strategies</li>
                            <li>You've committed to specific changes in your study habits</li>
                        </ul>
                        <p style="margin-top: 1rem;"><em>Your complete roadmap will be available for download after a brief analysis of your data.</em></p>
                    `;
                }
            }
        }
        
        // ==================== EVENT LISTENERS ====================
        
        // Phase 1: Reflection text input
        document.getElementById('reflectionText').addEventListener('input', function() {
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].personalReflection = this.value;
            validateReflectionInput();
            saveState();
        });
        
        // Phase 1: Continue to Phase 2
        document.getElementById('reflectionContinueBtn').addEventListener('click', function() {
            document.getElementById('phase2').classList.remove('hidden');
            document.getElementById('phase2').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        
        // Phase 2: Curiosity response
        document.querySelectorAll('input[name="curiosityResponse"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const expId = state.lastViewedExperimentId;
                state.experiments[expId].curiosityResponse = this.value;
                validateCuriosityInputs();
                saveState();
            });
        });
        
        // Phase 2: Curiosity explanation
        document.getElementById('curiosityExplanation').addEventListener('input', function() {
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].curiosityExplanation = this.value;
            saveState();
        });
        
        // Phase 2: Continue to Phase 3a
        document.getElementById('curiosityContinueBtn').addEventListener('click', function() {
            document.getElementById('phase3a').classList.remove('hidden');
            document.getElementById('phase3a').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        
        // Phase 3a: RQ understanding
        document.getElementById('rqUnderstanding').addEventListener('change', function() {
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].rqUnderstanding = this.value;
            validateRQUnderstanding();
            saveState();
        });
        
        // Phase 3a: Continue to Phase 3b
        document.getElementById('rqContinueBtn').addEventListener('click', function() {
            document.getElementById('phase3b').classList.remove('hidden');
            document.getElementById('phase3b').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        
        // Phase 3b: Hypothesis format quiz
        document.querySelectorAll('input[name="hypothesisFormat"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const expId = state.lastViewedExperimentId;
                const feedback = document.getElementById('hypothesisFeedback');
                const continueBtn = document.getElementById('hypothesisContinueBtn');
                
                if (this.value === 'format2') {
                    feedback.style.display = 'block';
                    continueBtn.disabled = false;
                    state.experiments[expId].hypothesisFormatCorrect = true;
                } else {
                    feedback.style.display = 'none';
                    continueBtn.disabled = true;
                    state.experiments[expId].hypothesisFormatCorrect = false;
                    alert('Try again! Remember: A hypothesis needs an "If...then..." structure with clear variables (IV affects DV).');
                }
                saveState();
            });
        });
        
        // Phase 3b: Continue to Phase 3c
        document.getElementById('hypothesisContinueBtn').addEventListener('click', function() {
            document.getElementById('phase3c').classList.remove('hidden');
            document.getElementById('phase3c').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        
        // Phase 3c: Prediction choice
        document.getElementById('predictionChoice').addEventListener('change', function() {
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].predictionChoice = this.value;
            validatePredictionInputs();
            saveState();
        });
        
        // Phase 3c: Prediction confidence
        document.getElementById('predictionConfidence').addEventListener('input', function() {
            const val = this.value;
            document.getElementById('confValue').textContent = val;
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].predictionConfidence = val;
            validatePredictionInputs();
            saveState();
        });
        
        // Phase 3c: Continue to Phase 4
        document.getElementById('predictionContinueBtn').addEventListener('click', function() {
            document.getElementById('phase4').classList.remove('hidden');
            document.getElementById('phase4').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        
        // Phase 4: Continue to Phase 5
        document.getElementById('designContinueBtn').addEventListener('click', function() {
            document.getElementById('phase5').classList.remove('hidden');
            document.getElementById('phase5').scrollIntoView({ behavior: 'smooth', block: 'start' });
            renderChart();
        });
        
        // Phase 5: Results reflection
        document.getElementById('resultsReflection').addEventListener('input', function() {
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].resultsReflection = this.value;
            validateResultsReflection();
            saveState();
        });
        
        // Phase 5: Continue to Phase 6
        document.getElementById('resultsContinueBtn').addEventListener('click', function() {
            document.getElementById('phase6').classList.remove('hidden');
            document.getElementById('phase6').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        
        // Phase 6: Experiment design inputs
        ['expCourse', 'expMaterial', 'expChange', 'expMeasure', 'expStart', 'expEval'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                const fieldName = id.replace('exp', '').toLowerCase();
                const field = fieldName === 'start' ? 'start' : fieldName === 'eval' ? 'eval' : fieldName;
                const expId = state.lastViewedExperimentId;
                state.experiments[expId].experimentDesign[field] = this.value;
                validateExperimentDesign();
                saveState();
            });
        });
        
        // Phase 6: Experiment commitment
        document.getElementById('expCommit').addEventListener('change', function() {
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].experimentCommit = this.checked;
            validateExperimentDesign();
            saveState();
        });
        
        // Phase 6: Complete experiment
        document.getElementById('commitContinueBtn').addEventListener('click', function() {
            const expId = state.lastViewedExperimentId;
            state.experiments[expId].completed = true;
            state.experiments[expId].completedDate = new Date().toISOString().split('T')[0];
            saveState();
            
            document.getElementById('phase7').classList.remove('hidden');
            document.getElementById('phase7').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            updateGlobalProgressUI();
            updateExperimentChips();
            updateProgressLabels();
        });
        
        // Phase 7: Next experiment button
        document.getElementById('nextExperimentBtn').addEventListener('click', function() {
            const nextId = getNextExperimentId();
            if (nextId) {
                state.lastViewedExperimentId = nextId;
                state.currentExperimentIndex = experimentOrder.indexOf(nextId);
                saveState();
                hydrateExperimentUI();
                showView('experiment');
                document.getElementById('phase1').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                showView('dashboard');
            }
        });
        
        // Navigation buttons
        document.querySelectorAll('[data-nav]').forEach(btn => {
            btn.addEventListener('click', function() {
                const target = this.getAttribute('data-nav');
                showView(target);
            });
        });
        
        // Export button
        document.getElementById('exportBtn').addEventListener('click', function() {
            let text = 'Metacognition Discovery Lab -- UW-Parkside PreMed\n';
            text += '='.repeat(80) + '\n\n';
            text += 'Export Date: ' + new Date().toLocaleDateString() + '\n';
            text += 'Completed Experiments: ' + Object.values(state.experiments).filter(e => e.completed).length + '/10\n\n';
            
            experimentOrder.forEach(expId => {
                const exp = state.experiments[expId];
                const data = experimentData[expId];
                
                text += data.title.toUpperCase() + '\n';
                text += '-'.repeat(80) + '\n';
                
                // Phase 1 Reflection
                text += 'PERSONAL REFLECTION:\n';
                text += (exp.personalReflection || '[Not completed]') + '\n\n';
                
                // Phase 2 Curiosity
                text += 'CURIOSITY RESPONSE: ';
                text += (exp.curiosityResponse ? exp.curiosityResponse.toUpperCase() : '[Not completed]');
                if (exp.curiosityExplanation) {
                    text += '\nExplanation: ' + exp.curiosityExplanation;
                }
                text += '\n\n';
                
                // Phase 3 Prediction
                text += 'PREDICTION: ' + (exp.predictionChoice || '[Not made]');
                text += ' | Confidence: ' + (exp.predictionConfidence || '[N/A]') + '/5\n\n';
                
                // Phase 5 Results Reflection
                if (exp.resultsReflection) {
                    text += 'RESULTS REFLECTION:\n';
                    text += exp.resultsReflection + '\n\n';
                }
                
                // Phase 6 Experiment Design
                text += 'PERSONAL EXPERIMENT DESIGN:\n';
                text += 'Course: ' + (exp.experimentDesign.course || '[Not set]') + '\n';
                text += 'Material: ' + (exp.experimentDesign.material || '[Not set]') + '\n';
                text += 'Change: ' + (exp.experimentDesign.change || '[Not set]') + '\n';
                text += 'Success Measure: ' + (exp.experimentDesign.measure || '[Not set]') + '\n';
                text += 'Start: ' + (exp.experimentDesign.start || '[Not set]') + ' | Evaluate: ' + (exp.experimentDesign.eval || '[Not set]') + '\n';
                text += 'Commitment: ' + (exp.experimentCommit ? 'Yes' : 'No') + '\n';
                
                text += 'Completed: ' + (exp.completed ? 'Yes (' + exp.completedDate + ')' : 'No') + '\n\n\n';
            });
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'metacognition-discovery-lab-export.txt';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        });
        
        // Reset button
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (confirm('This will clear ALL your saved data and reset the lab. Are you sure?')) {
                localStorage.removeItem(STORAGE_KEY);
                state = structuredClone(defaultState);
                location.reload();
            }
        });
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            buildDashboard();
            updateGlobalProgressUI();
            updateProgressLabels();
            updateExperimentChips();
            clearPhases();
            
            // Show landing page by default
            showView('landing');
        });
    </script>
<script>
(function() {
  function initNav() {
    var labs = [{"folder":"bios101-learning","title":"Metacognition"},{"folder":"01_Science_of_Biology","title":"Scientific Process"},{"folder":"02_Eukaryotes","title":"Eukaryotes"},{"folder":"03_Carbohydrates","title":"Carbohydrates"},{"folder":"04_Proteins","title":"Proteins"},{"folder":"05_Lipids","title":"Lipids"},{"folder":"06_Photosynthetic_Pigments","title":"Photosynthesis"},{"folder":"07_Nucleic Acids","title":"Nucleic Acids"},{"folder":"08_Mitosis","title":"Mitosis"},{"folder":"09_Meiosis","title":"Meiosis"},{"folder":"10_Genetics","title":"Genetics"}];
    var menus = document.getElementById('biosMenus');
    var path = location.pathname;
    if (!menus) return;
    labs.forEach(function(lab) {
      var m = document.createElement('div');
      m.className = 'bios-menu';
      var b = document.createElement('button');
      b.className = 'bios-trigger';
      b.textContent = lab.title;
      if (path.indexOf(lab.folder) !== -1) b.classList.add('active');
      var d = document.createElement('div');
      d.className = 'bios-dropdown';
      var bp = '../../' + lab.folder;
      d.innerHTML = '<a href="' + bp + '/index.html">Overview</a><a href="' + bp + '/prelab/prelab.html">Pre-Lab</a><a href="' + bp + '/during_lab/in-lab.html">In-Lab</a><a href="' + bp + '/postlab/postlab.html">Post-Lab</a><a href="' + bp + '/advanced/optional.html">Optional</a>';
      m.appendChild(b);
      m.appendChild(d);
      menus.appendChild(m);
    });
    var t = document.querySelector('.bios-toggle');
    if (t) t.onclick = function() { menus.classList.toggle('open'); };
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNav);
  } else {
    initNav();
  }
})();
</script>
</body>
</html>
