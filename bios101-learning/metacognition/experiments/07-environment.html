<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Exposure Test - Metacognition Lab</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        /* Page-specific overrides */
        .banner {
            border-left-color: var(--uwp-goldenrod);
        }
    </style>
</head>

<body>
    <nav class="bios-nav">
        <div class="bios-nav-inner">
            <a href="../index.html" class="bios-home">BIOS101</a>
            <div class="bios-menus">
                <div class="bios-menu">
                    <a href="../dashboard.html" class="bios-trigger">Metacognition Dashboard</a>
                </div>
            </div>
        </div>
    </nav>

    <header>
        <div class="shell">
            <div class="header-brand">
                <div class="header-brand-icon">07</div>
                <span>Environment Exposure Test</span>
            </div>
            <div class="progress-shell">
                <div class="progress-track">
                    <div class="progress-bar" id="localProgressBar" style="width: 0%"></div>
                </div>
                <div class="progress-label" id="localProgressLabel">Phase 1 of 7</div>
            </div>
        </div>
    </header>

    <main>
        <div class="view active" id="view-experiment">
            <div class="pill-nav">
                <a href="../dashboard.html" class="btn btn-secondary">← Back to Dashboard</a>
            </div>

            <div class="banner">
                <h2>Quiet > Lyrics/Busy Spaces (For Complex Reading)</h2>
                <p class="subline">Why your study environment might be sabotaging your focus and retention.</p>
            </div>

            <section id="phase1">
                <div class="card stack">
                    <h2>Phase 1: Observation</h2>
                    <p class="meta">Carefully read, analyze, and reflect on the following.</p>

                    <div class="observation-box" id="observationBox">
                        <p>"I usually study in places that feel comfortable or familiar — coffee shops, the student union, my dorm with music playing, or anywhere that doesn't feel too quiet. I think I choose these spots because silence makes studying feel harder or more serious, and background noise makes me feel less stressed. But when I'm honest, I notice I end up rereading paragraphs over and over. I get distracted by conversations, people walking around, or even just the music I thought was helping me focus. Sometimes I leave a study session feeling like I was studying the whole time, but I can't remember much of what I read. I'm starting to realize that the environment I choose might be sabotaging the quality of my studying. I don't think I've ever actually tested whether I learn better in a quiet space — I've just assumed the busy background helps me. Now I'm wondering if my surroundings are making my studying feel productive without truly helping me concentrate."</p>
                    </div>

                    <label for="reflectionText">Take a moment to reflect. How does this observation connect to YOUR own experience?</label>
                    <textarea id="reflectionText" placeholder="Write at least 10 words describing how the above observation mirrors or differs from your actual experience. What environments do you typically study in?"></textarea>
                    <p class="meta"><span id="reflectionMeta">0</span> / 50 words minimum</p>
                    <button class="btn btn-primary" id="reflectionContinueBtn" disabled>I've reflected — Continue to Curiosity Question</button>
                </div>
            </section>

            <section id="phase2" class="hidden">
                <div class="card stack">
                    <h2>Phase 2: The Curiosity Question</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> This phase transforms a personal observation into structured scientific curiosity.</p>

                    <div class="observation-box" id="curiosityBox">
                        <p><strong>How much would my comprehension improve if I studied the same material in a quiet library versus my usual coffee shop?</strong></p>
                    </div>

                    <div class="field">
                        <label>Based on your actual study habits:</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="agree">
                                <span><strong>Agree</strong> - This reflects my experience exactly</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="disagree">
                                <span><strong>Disagree</strong> - This doesn't match my habits</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="unsure">
                                <span><strong>Unsure</strong> - I need to think about this more</span>
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label for="curiosityExplanation">Briefly explain your choice:</label>
                        <textarea id="curiosityExplanation" placeholder="Why does/doesn't this question resonate with you? What environments do you usually choose and why?"></textarea>
                    </div>

                    <button class="btn btn-primary" id="curiosityContinueBtn" disabled>Continue to Research Question</button>
                </div>
            </section>

            <section id="phase3a" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (1/3)</h2>
                    <div class="observation-box">
                        <h3>Research Question</h3>
                        <p style="font-weight: 600;">Does studying in quiet environments produce better reading comprehension and memory performance compared to studying in noisy or busy environments?</p>
                    </div>

                    <div class="field">
                        <label for="rqUnderstanding">Rate your understanding of this research question:</label>
                        <select id="rqUnderstanding">
                            <option value="">-- Select your understanding level --</option>
                            <option value="clear">Clear - I understand exactly what's being investigated</option>
                            <option value="somewhat">Somewhat - I have a general idea but some questions</option>
                            <option value="confused">Confused - I'm not sure what's being studied</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" id="rqContinueBtn" disabled>Proceed to Hypothesis →</button>
                </div>
            </section>

            <section id="phase3b" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (2/3)</h2>

                    <h3>The Hypothesis</h3>
                    <div class="observation-box">
                        <p><strong>Quiet environment</strong> (IV) produces <strong>better comprehension and retention</strong> (DV) than noisy environments when <strong>material and time are held constant</strong> (CV).</p>
                    </div>
                    <p class="meta" style="margin-top:0.5rem;"><strong>Why this works:</strong> Background noise and interruptions divide attention, increasing cognitive load and reducing working memory available for encoding material.</p>

                    <div class="field" style="margin-top: 1rem; border-top: 1px solid #eee; padding-top: 1rem;">
                        <label>Test Your Understanding: Which statement describes a valid Hypothesis?</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="prediction_error">
                                <span>"If I study in a quiet library, I will get better grades."</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="correct_answer">
                                <span>"It is a tentative answer to the Research Question proposing a relationship between variables."</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="vague_error">
                                <span>"It is a fact found in the textbook."</span>
                            </label>
                        </div>
                    </div>

                    <div class="hypothesis-feedback" id="hypothesisFeedback"></div>
                    <button class="btn btn-primary" id="hypothesisContinueBtn" disabled>Proceed to Your Prediction →</button>
                </div>
            </section>

            <section id="phase3c" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (3/3) - Prediction</h2>

                    <div class="field">
                        <label for="predictionChoice">Based on the hypothesis, select the environment that will produce better comprehension and retention?</label>
                        <select id="predictionChoice">
                            <option value="">-- Select your prediction --</option>
                            <option value="quiet">Quiet environment</option>
                            <option value="music">Background music</option>
                            <option value="busy">Busy/noisy space</option>
                        </select>
                    </div>

                    <div class="field">
                        <label for="predictionConfidence">How confident are you in this prediction? (1 = guessing, 5 = very confident)</label>
                        <input type="range" id="predictionConfidence" min="1" max="5" value="3">
                        <p class="meta">Confidence: <span id="confValue">3</span>/5</p>
                    </div>

                    <button class="btn btn-primary" id="predictionContinueBtn" disabled>Lock in my prediction →</button>
                </div>
            </section>

            <section id="phase4" class="hidden">
                <div class="card stack">
                    <h2>Phase 4: Experimental Design</h2>

                    <h3>The Original Study: Sörqvist et al. (2010)</h3>
                    <div class="observation-box">
                        <p>Students read complex material. One group studies in a quiet room. Another group studies with background music (no lyrics). A third group studies in a busy cafeteria. All groups read the same material for the same amount of time. Comprehension is measured immediately after studying and again after 1 week.</p>
                    </div>

                    <h3>My Personal Experiment Design</h3>
                    <div class="observation-box">
                        <p>I will choose a chapter from my textbook and study it in three different environments on three separate days: (1) A quiet library study room, (2) My dorm room with background music playing, and (3) A busy coffee shop. Each session will be exactly 45 minutes long. Immediately after each session, I will write down everything I can remember without looking at the material. I will compare the quantity and accuracy of recall from each environment.</p>
                    </div>

                    <button class="btn btn-primary" id="designContinueBtn">Show me the results</button>
                </div>
            </section>

            <section id="phase5" class="hidden">
                <div class="card stack">
                    <h2>Phase 5: The Results</h2>
                    <p class="explanation-box">Here is what happened in the original study.</p>

                    <div class="data-viz-box">
                        <canvas id="resultsChart" style="max-height:250px;"></canvas>
                    </div>

                    <div class="citation-box">
                        <h4>Original Study Details</h4>
                        <p class="meta"><strong>Citation:</strong> Sörqvist, P., Nöstl, A., & Halin, N. (2010). Disruption of writing processes by the semanticity of background speech. Scandinavian Journal of Psychology, 51(2), 97-102.</p>
                        <p class="meta"><strong>Result:</strong> Quiet environments produced significantly better comprehension and retention than noisy or musical environments, with the gap widening on delayed tests.</p>
                    </div>

                    <div class="observation-box" style="border-left: 3px solid var(--uwp-green);">
                        <h4>Conclusion</h4>
                        <p><strong>Hypothesis ACCEPTED.</strong> Environmental distractions have measurable negative effects on learning complex material. The feeling that background noise "helps" is often an illusion that masks reduced cognitive processing.</p>
                    </div>

                    <div class="field">
                        <label for="resultsReflection">Your Metacognitive Reflection (Required):</label>
                        <p class="subline">How does this evidence challenge or confirm your current study habits?</p>
                        <textarea id="resultsReflection" placeholder="I was surprised to learn... This matters for my studying because..."></textarea>
                        <p class="meta"><span id="reflectionWordCount">0</span> / 75 words minimum</p>
                    </div>

                    <button class="btn btn-primary" id="resultsContinueBtn" disabled>Continue to Design Your Experiment</button>
                </div>
            </section>

            <section id="phase6" class="hidden">
                <div class="card stack">
                    <h2>Phase 6: Your Personal Experiment</h2>
                    <p class="explanation-box">Commit to applying this strategy in your actual coursework.</p>

                    <div class="field">
                        <label for="expCourse">Which course will you test this in?</label>
                        <input type="text" id="expCourse" placeholder="e.g., Biology 101">
                    </div>
                    <div class="field">
                        <label for="expMaterial">What specific material/topic?</label>
                        <input type="text" id="expMaterial" placeholder="e.g., Cellular Respiration, Photosynthesis">
                    </div>
                    <div class="field">
                        <label for="expChange">What will you do differently?</label>
                        <textarea id="expChange" placeholder="Instead of studying with distractions, I will..."></textarea>
                    </div>
                    <div class="field">
                        <label for="expMeasure">How will you measure success?</label>
                        <input type="text" id="expMeasure" placeholder="e.g., Recall accuracy > 85% in quiet environment">
                    </div>
                    <div class="row-flex">
                        <div class="field">
                            <label for="expStart">Start Date</label>
                            <input type="date" id="expStart">
                        </div>
                        <div class="field">
                            <label for="expEval">Evaluation Date</label>
                            <input type="date" id="expEval">
                        </div>
                    </div>
                    <div style="margin: 0.5rem 0;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="expCommit">
                            <strong>I commit to running this experiment</strong>
                        </label>
                    </div>
                    <button class="btn btn-primary" id="commitContinueBtn" disabled>Complete Experiment</button>
                </div>
            </section>

            <section id="phase7" class="hidden">
                <div class="card stack" style="text-align: center; border: 2px solid var(--uwp-green); background: #f0f9f0;">
                    <div style="font-size: 3rem; color: var(--uwp-green);">✓</div>
                    <h2>Experiment Complete!</h2>
                    <p>You have successfully designed an Environment Optimization strategy.</p>
                    <div class="row-flex" style="justify-content: center; margin-top: 1rem;">
                        <a href="../dashboard.html" class="btn btn-secondary">Return to Dashboard</a>
                        <a href="08-time-of-day.html" class="btn btn-primary">Next Experiment →</a>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/logic.js"></script>

    <script>
        const CURRENT_EXPERIMENT_ID = 'environment';

        // Helper to show next phase and scroll
        const goToPhase = (currentId, nextId) => {
            const nextPhase = document.getElementById(nextId);
            if (nextPhase) {
                nextPhase.classList.remove('hidden');
                nextPhase.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        // Initialize Specific Chart for Environment Test
        function renderSpecificChart() {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Quiet Environment', 'Background Music', 'Busy/Noisy Space'],
                    datasets: [{
                        label: 'Immediate Comprehension (%)',
                        data: [84, 71, 68],
                        backgroundColor: ['#016836', '#4b7c4c', '#cbd5e1'],
                        borderColor: ['#00502f', '#00502f', '#4b5563'],
                        borderWidth: 2
                    }, {
                        label: 'Delayed Retention (%)',
                        data: [76, 62, 59],
                        backgroundColor: ['#e8f5e9', '#d4edda', '#f8d7da'],
                        borderColor: ['#016836', '#4b7c4c', '#cbd5e1'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            title: {
                                display: true,
                                text: 'Performance (%)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Environment Impact on Learning'
                        }
                    }
                }
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            if (typeof initExperiment === 'function') initExperiment(CURRENT_EXPERIMENT_ID);

            // --- PHASE 1: Reflection Logic ---
            const reflectionInput = document.getElementById('reflectionText');
            const reflectionBtn = document.getElementById('reflectionContinueBtn');
            reflectionInput?.addEventListener('input', () => {
                const wordCount = reflectionInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('reflectionMeta').textContent = wordCount;
                reflectionBtn.disabled = wordCount < 50;
            });
            reflectionBtn?.addEventListener('click', () => goToPhase('phase1', 'phase2'));

            // --- PHASE 2: Curiosity Logic ---
            const curiosityBtn = document.getElementById('curiosityContinueBtn');
            document.querySelectorAll('input[name="curiosityResponse"]').forEach(radio => {
                radio.addEventListener('change', () => curiosityBtn.disabled = false);
            });
            curiosityBtn?.addEventListener('click', () => goToPhase('phase2', 'phase3a'));

            // --- PHASE 3a: RQ Logic ---
            const rqBtn = document.getElementById('rqContinueBtn');
            document.getElementById('rqUnderstanding')?.addEventListener('change', (e) => {
                rqBtn.disabled = e.target.value === "";
            });
            rqBtn?.addEventListener('click', () => goToPhase('phase3a', 'phase3b'));

            // --- PHASE 3b: Hypothesis Logic ---
            const hypBtn = document.getElementById('hypothesisContinueBtn');
            document.querySelectorAll('input[name="hypothesisFormat"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const feedback = document.getElementById('hypothesisFeedback');
                    if (e.target.value === 'correct_answer') {
                        feedback.innerHTML = "<p style='color:green;'>Correct! A hypothesis is a testable prediction.</p>";
                        hypBtn.disabled = false;
                    } else {
                        feedback.innerHTML = "<p style='color:red;'>Not quite. Try again.</p>";
                        hypBtn.disabled = true;
                    }
                });
            });
            hypBtn?.addEventListener('click', () => goToPhase('phase3b', 'phase3c'));

            // --- PHASE 3c: Prediction Logic ---
            const predBtn = document.getElementById('predictionContinueBtn');
            document.getElementById('predictionChoice')?.addEventListener('change', (e) => {
                predBtn.disabled = e.target.value === "";
            });
            predBtn?.addEventListener('click', () => goToPhase('phase3c', 'phase4'));

            // --- PHASE 4: Design Logic ---
            document.getElementById('designContinueBtn')?.addEventListener('click', () => {
                renderSpecificChart();
                goToPhase('phase4', 'phase5');
            });

            // --- PHASE 5: Results Reflection ---
            const resInput = document.getElementById('resultsReflection');
            const resBtn = document.getElementById('resultsContinueBtn');
            resInput?.addEventListener('input', () => {
                const count = resInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('reflectionWordCount').textContent = count;
                resBtn.disabled = count < 75;
            });
            resBtn?.addEventListener('click', () => goToPhase('phase5', 'phase6'));

            // --- PHASE 6: Personal Experiment Logic ---
            const commitBtn = document.getElementById('commitContinueBtn');
            document.getElementById('expCommit')?.addEventListener('change', (e) => {
                commitBtn.disabled = !e.target.checked;
            });
            commitBtn?.addEventListener('click', () => goToPhase('phase6', 'phase7'));
        });
    </script>
</body>

</html>
