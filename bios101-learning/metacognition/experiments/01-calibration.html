<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confidence Calibration Lab - Metacognition Lab</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        /* Page-specific overrides */
        .banner {
            border-left-color: var(--uwp-goldenrod);
        }
    </style>
</head>
<body>
    <nav class="bios-nav">
        <div class="bios-nav-inner">
            <a href="../index.html" class="bios-home">BIOS101</a>
            <div class="bios-menus">
                <div class="bios-menu">
                    <a href="../dashboard.html" class="bios-trigger">Metacognition Dashboard</a>
                </div>
            </div>
        </div>
    </nav>

    <header>
        <div class="shell">
            <div class="header-brand">
                <div class="header-brand-icon">01</div>
                <span>Confidence Calibration Lab</span>
            </div>
            <div class="progress-shell">
                <div class="progress-track">
                    <div class="progress-bar" id="localProgressBar" style="width: 0%"></div>
                </div>
                <div class="progress-label" id="localProgressLabel">Phase 1 of 7</div>
            </div>
        </div>
    </header>

    <main>
        <div class="view active" id="view-experiment">
            <div class="pill-nav">
                <a href="../dashboard.html" class="btn btn-secondary">‚Üê Back to Dashboard</a>
            </div>

            <div class="banner">
                <h2>Prediction vs Reality Sharpens Study Choices</h2>
                <p class="subline">Why confidence doesn't always match performance.</p>
            </div>

            <section id="phase1">
                <div class="card stack">
                    <h2>Phase 1: Observation</h2>
                    <p class="meta">Carefully read, analyze, and reflect on the following.</p>

                    <div class="observation-box" id="observationBox">
                        <p>"In my own experience, I have noticed that after exams I often feel confident about how I did, but when I receive my grade, the result does not always match that confidence. Sometimes I am surprised that my score is lower than expected, even though I believed I understood the material while studying and during the test. Other times, I feel unsure about my performance and yet still receive a reasonable grade. This mismatch between how confident I feel and how I actually perform has made me realize that judging my own learning is difficult. I can tell when I studied hard, but I am not always able to accurately evaluate whether my understanding is strong enough to lead to good exam results."</p>
                    </div>

                    <label for="reflectionText">Take a moment to reflect. How does this observation connect to YOUR own experience?</label>
                    <textarea id="reflectionText" placeholder="Write at least 10 words describing how the above observation mirrors or differs from your actual experience. Can you relate to the mismatch between confidence and performance?"></textarea>
                    <p class="meta"><span id="reflectionMeta">0</span> / 50 words minimum</p>
                    <button class="btn btn-primary" id="reflectionContinueBtn" disabled>I've reflected ‚Äî Continue to Curiosity Question</button>
                </div>
            </section>

            <section id="phase2" class="hidden">
                <div class="card stack">
                    <h2>Phase 2: The Curiosity Question</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> This phase transforms a personal observation into structured scientific curiosity.</p>

                    <div class="observation-box" id="curiosityBox">
                        <p><strong>What would happen if I tracked my predictions versus my actual performance to see if I can improve my self-awareness?</strong></p>
                    </div>

                    <div class="field">
                        <label>Based on your actual test taking experiences:</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="agree">
                                <span><strong>Agree</strong> - This reflects my experience exactly</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="disagree">
                                <span><strong>Disagree</strong> - This doesn't match my habits</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="unsure">
                                <span><strong>Unsure</strong> - I need to think about this more</span>
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label for="curiosityExplanation">Briefly explain your choice:</label>
                        <textarea id="curiosityExplanation" placeholder="Why does/doesn't this question resonate with you?"></textarea>
                    </div>

                    <button class="btn btn-primary" id="curiosityContinueBtn" disabled>Continue to Research Question</button>
                </div>
            </section>

            <section id="phase3a" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (1/3)</h2>
                    <div class="observation-box">
                        <h3>Research Question</h3>
                        <p style="font-weight: 600;">Does comparing my predicted performance with my actual performance help me choose more effective study strategies?</p>
                    </div>

                    <div class="field">
                        <label for="rqUnderstanding">Rate your understanding of this research question:</label>
                        <select id="rqUnderstanding">
                            <option value="">-- Select your understanding level --</option>
                            <option value="clear">Clear - I understand exactly what's being investigated</option>
                            <option value="somewhat">Somewhat - I have a general idea but some questions</option>
                            <option value="confused">Confused - I'm not sure what's being studied</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" id="rqContinueBtn" disabled>Proceed to Hypothesis ‚Üí</button>
                </div>
            </section>

            <section id="phase3b" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (2/3)</h2>

                    <h3>The Hypothesis</h3>
                    <div class="observation-box">
                        <p><strong>Systematically tracking the gap between predicted and actual scores</strong> (IV) increases <strong>study strategy effectiveness and academic performance</strong> (DV).</p>
                    </div>
                    <p class="meta" style="margin-top:0.5rem;"><strong>Why this works:</strong> Metacognitive monitoring (knowing what you know) directly improves learning outcomes when operationalized through prediction-actual comparison.</p>

                    <div class="field" style="margin-top: 1rem; border-top: 1px solid #eee; padding-top: 1rem;">
                        <label>Test Your Understanding: Which statement describes a valid Hypothesis?</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="prediction_error">
                                <span>"If I study hard, I will get an A."</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="correct_answer">
                                <span>"It is a tentative answer to the Research Question proposing a relationship between variables."</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="vague_error">
                                <span>"It is a fact found in the textbook."</span>
                            </label>
                        </div>
                    </div>

                    <div class="hypothesis-feedback" id="hypothesisFeedback"></div>
                    <button class="btn btn-primary" id="hypothesisContinueBtn" disabled>Proceed to Your Prediction ‚Üí</button>
                </div>
            </section>

            <section id="phase3c" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (3/3) - Prediction</h2>

                    <div class="field">
                        <label for="predictionChoice">Based on the hypothesis, select the prediction strategy that will produce better results?</label>
                        <select id="predictionChoice">
                            <option value="">-- Select your prediction --</option>
                            <option value="track">Tracking my predicted vs actual scores</option>
                            <option value="notrack">Not tracking my predictions</option>
                            <option value="same">They will be about the same</option>
                        </select>
                    </div>

                    <div class="field">
                        <label for="predictionConfidence">How confident are you in this prediction? (1 = guessing, 5 = very confident)</label>
                        <input type="range" id="predictionConfidence" min="1" max="5" value="3">
                        <p class="meta">Confidence: <span id="confValue">3</span>/5</p>
                    </div>

                    <button class="btn btn-primary" id="predictionContinueBtn" disabled>Lock in my prediction ‚Üí</button>
                </div>
            </section>

            <section id="phase4" class="hidden">
                <div class="card stack">
                    <h2>Phase 4: Experimental Design</h2>

                    <h3>The Original Study: de Bruin et al. (2020)</h3>
                    <div class="observation-box">
                        <p>Students predict their quiz score, take the quiz, then compare. Over 4 quizzes, they track calibration patterns. Control group takes quizzes without predictions. All receive same study materials.</p>
                    </div>

                    <h3>My Personal Experiment Design</h3>
                    <div class="observation-box">
                        <p>For each quiz, I will write down my predicted overall score before starting. I will also mark my confidence for every individual question before answering it: ‚úì (predict correct), ? (unsure), or üõë (predict incorrect). After the quiz, I will compare all predictions to actual results to see whether my study strategies are giving me a false sense of mastery or accurately preparing me.</p>
                    </div>

                    <button class="btn btn-primary" id="designContinueBtn">Show me the results</button>
                </div>
            </section>

            <section id="phase5" class="hidden">
                <div class="card stack">
                    <h2>Phase 5: The Results</h2>
                    <p class="explanation-box">Here is what happened in the original study.</p>

                    <div class="data-viz-box">
                        <canvas id="resultsChart" style="max-height:250px;"></canvas>
                    </div>

                    <div class="citation-box">
                        <h4>Original Study Details</h4>
                        <p class="meta"><strong>Citation:</strong> de Bruin, A. B., Roelle, J., Carpenter, S. K., & Baars, M. (2020). Synthesizing cognitive load and self-regulation theory. Educational Psychology Review, 32(4), 903-915.</p>
                        <p class="meta"><strong>Result:</strong> Tracking predictions improved average grades from 72% to 79% and enhanced study strategy consistency.</p>
                    </div>

                    <div class="observation-box" style="border-left: 3px solid var(--uwp-green);">
                        <h4>Conclusion</h4>
                        <p><strong>Hypothesis ACCEPTED.</strong> Calibration tracking improves study strategy selection and academic performance.</p>
                    </div>

                    <div class="field">
                        <label for="resultsReflection">Your Metacognitive Reflection (Required):</label>
                        <p class="subline">How does this evidence challenge or confirm your current study habits?</p>
                        <textarea id="resultsReflection" placeholder="I was surprised to learn... This matters for my studying because..."></textarea>
                        <p class="meta"><span id="reflectionWordCount">0</span> / 75 words minimum</p>
                    </div>

                    <button class="btn btn-primary" id="resultsContinueBtn" disabled>Continue to Design Your Experiment</button>
                </div>
            </section>

            <section id="phase6" class="hidden">
                <div class="card stack">
                    <h2>Phase 6: Your Personal Experiment</h2>
                    <p class="explanation-box">Commit to applying this strategy in your actual coursework.</p>

                    <div class="field">
                        <label for="expCourse">Which course will you test this in?</label>
                        <input type="text" id="expCourse" placeholder="e.g., Biology 101">
                    </div>
                    <div class="field">
                        <label for="expMaterial">What specific material/topic?</label>
                        <input type="text" id="expMaterial" placeholder="e.g., Cellular Respiration">
                    </div>
                    <div class="field">
                        <label for="expChange">What will you do differently?</label>
                        <textarea id="expChange" placeholder="Instead of just studying, I will..."></textarea>
                    </div>
                    <div class="field">
                        <label for="expMeasure">How will you measure success?</label>
                        <input type="text" id="expMeasure" placeholder="e.g., Prediction accuracy improves by 20%">
                    </div>
                    <div class="row-flex">
                        <div class="field">
                            <label for="expStart">Start Date</label>
                            <input type="date" id="expStart">
                        </div>
                        <div class="field">
                            <label for="expEval">Evaluation Date</label>
                            <input type="date" id="expEval">
                        </div>
                    </div>
                    <div style="margin: 0.5rem 0;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="expCommit">
                            <strong>I commit to running this experiment</strong>
                        </label>
                    </div>
                    <button class="btn btn-primary" id="commitContinueBtn" disabled>Complete Experiment</button>
                </div>
            </section>

            <section id="phase7" class="hidden">
                <div class="card stack" style="text-align: center; border: 2px solid var(--uwp-green); background: #f0f9f0;">
                    <div style="font-size: 3rem; color: var(--uwp-green);">‚úì</div>
                    <h2>Experiment Complete!</h2>
                    <p>You have successfully designed a Confidence Calibration strategy.</p>
                    <div class="row-flex" style="justify-content: center; margin-top: 1rem;">
                        <a href="../dashboard.html" class="btn btn-secondary">Return to Dashboard</a>
                        <a href="02-error-hunting.html" class="btn btn-primary">Next Experiment ‚Üí</a>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/logic.js"></script>

    <script>
        const CURRENT_EXPERIMENT_ID = 'calibration';

        // Helper to show next phase and scroll
        const goToPhase = (currentId, nextId) => {
            const nextPhase = document.getElementById(nextId);
            if (nextPhase) {
                nextPhase.classList.remove('hidden');
                nextPhase.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        // Initialize Specific Chart for Calibration
        function renderSpecificChart() {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['No Tracking', 'With Tracking'],
                    datasets: [{
                        label: 'Average Grade (%)',
                        data: [72, 79],
                        backgroundColor: ['#cbd5e1', '#016836'],
                        borderColor: ['#4b5563', '#00502f'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            title: {
                                display: true,
                                text: 'Grade (%)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Impact of Calibration Tracking'
                        }
                    }
                }
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            if (typeof initExperiment === 'function') initExperiment(CURRENT_EXPERIMENT_ID);

            // --- PHASE 1: Reflection Logic ---
            const reflectionInput = document.getElementById('reflectionText');
            const reflectionBtn = document.getElementById('reflectionContinueBtn');
            reflectionInput?.addEventListener('input', () => {
                const wordCount = reflectionInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('reflectionMeta').textContent = wordCount;
                reflectionBtn.disabled = wordCount < 50;
            });
            reflectionBtn?.addEventListener('click', () => goToPhase('phase1', 'phase2'));

            // --- PHASE 2: Curiosity Logic ---
            const curiosityBtn = document.getElementById('curiosityContinueBtn');
            document.querySelectorAll('input[name="curiosityResponse"]').forEach(radio => {
                radio.addEventListener('change', () => curiosityBtn.disabled = false);
            });
            curiosityBtn?.addEventListener('click', () => goToPhase('phase2', 'phase3a'));

            // --- PHASE 3a: RQ Logic ---
            const rqBtn = document.getElementById('rqContinueBtn');
            document.getElementById('rqUnderstanding')?.addEventListener('change', (e) => {
                rqBtn.disabled = e.target.value === "";
            });
            rqBtn?.addEventListener('click', () => goToPhase('phase3a', 'phase3b'));

            // --- PHASE 3b: Hypothesis Logic ---
            const hypBtn = document.getElementById('hypothesisContinueBtn');
            document.querySelectorAll('input[name="hypothesisFormat"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const feedback = document.getElementById('hypothesisFeedback');
                    if (e.target.value === 'correct_answer') {
                        feedback.innerHTML = "<p style='color:green;'>Correct! A hypothesis is a testable prediction.</p>";
                        hypBtn.disabled = false;
                    } else {
                        feedback.innerHTML = "<p style='color:red;'>Not quite. Try again.</p>";
                        hypBtn.disabled = true;
                    }
                });
            });
            hypBtn?.addEventListener('click', () => goToPhase('phase3b', 'phase3c'));

            // --- PHASE 3c: Prediction Logic ---
            const predBtn = document.getElementById('predictionContinueBtn');
            document.getElementById('predictionChoice')?.addEventListener('change', (e) => {
                predBtn.disabled = e.target.value === "";
            });
            predBtn?.addEventListener('click', () => goToPhase('phase3c', 'phase4'));

            // --- PHASE 4: Design Logic ---
            document.getElementById('designContinueBtn')?.addEventListener('click', () => {
                renderSpecificChart();
                goToPhase('phase4', 'phase5');
            });

            // --- PHASE 5: Results Reflection ---
            const resInput = document.getElementById('resultsReflection');
            const resBtn = document.getElementById('resultsContinueBtn');
            resInput?.addEventListener('input', () => {
                const count = resInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('reflectionWordCount').textContent = count;
                resBtn.disabled = count < 75;
            });
            resBtn?.addEventListener('click', () => goToPhase('phase5', 'phase6'));

            // --- PHASE 6: Personal Experiment Logic ---
            const commitBtn = document.getElementById('commitContinueBtn');
            document.getElementById('expCommit')?.addEventListener('change', (e) => {
                commitBtn.disabled = !e.target.checked;
            });
            commitBtn?.addEventListener('click', () => goToPhase('phase6', 'phase7'));
        });
    </script>
</body>
</html>
