<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Strategy Lab - Metacognition Lab</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        /* Page-specific overrides */
        .banner {
            border-left-color: var(--uwp-goldenrod);
        }
    </style>
</head>

<body>
    <nav class="bios-nav">
        <div class="bios-nav-inner">
            <a href="../index.html" class="bios-home">BIOS101</a>
            <div class="bios-menus">
                <div class="bios-menu">
                    <a href="../dashboard.html" class="bios-trigger">Metacognition Dashboard</a>
                </div>
            </div>
        </div>
    </nav>

    <header>
        <div class="shell">
            <div class="header-brand">
                <div class="header-brand-icon">10</div>
                <span>Spacing + Retrieval Combined Strategy</span>
            </div>
            <div class="progress-shell">
                <div class="progress-track">
                    <div class="progress-bar" id="localProgressBar" style="width: 0%"></div>
                </div>
                <div class="progress-label" id="localProgressLabel">Phase 1 of 7</div>
            </div>
        </div>
    </header>

    <main>
        <div class="view active" id="view-experiment">
            <div class="pill-nav">
                <a href="../dashboard.html" class="btn btn-secondary">← Back to Dashboard</a>
            </div>

            <div class="banner">
                <h2>Spacing + Retrieval Synergy</h2>
                <p class="subline">Optimal learning requires both temporal distribution and active engagement.</p>
            </div>

            <!-- Phase 1: Observation -->
            <section id="phase1">
                <div class="card stack">
                    <h2>Phase 1: Observation</h2>
                    <p class="meta">Carefully read, analyze, and reflect on the following.</p>

                    <div class="observation-box" id="observationBox">
                        <p>"My study habits are all-or-nothing. Either I cram everything in one long session, or I passively reread my notes over and over. I almost never break my study into smaller, spaced sessions, and I rarely test myself. When I do space things out, it's usually just rereading the same material, not actively recalling it. And when I do test myself, it's usually in one big review session right before the exam. I've never tried combining the two—studying in smaller chunks spread over time AND actively quizzing myself after each session. I'm starting to wonder if I'm missing out on a powerful combination. Maybe each strategy amplifies the other? But it feels like more planning and effort, so I default to what's familiar even if it's less effective."</p>
                    </div>

                    <label for="reflectionText">Take a moment to reflect. How does this observation connect to YOUR own experience?</label>
                    <textarea id="reflectionText" placeholder="Write at least 50 words describing how the above observation mirrors or differs from your actual experience. Do you use spacing OR retrieval, or have you tried combining them?"></textarea>
                    <p class="meta"><span id="reflectionMeta">0</span> / 50 words minimum</p>
                    <button class="btn btn-primary" id="reflectionContinueBtn" disabled>I've reflected — Continue to Curiosity Question</button>
                </div>
            </section>

            <!-- Phase 2: Curiosity Question -->
            <section id="phase2" class="hidden">
                <div class="card stack">
                    <h2>Phase 2: The Curiosity Question</h2>
                    <p class="explanation-box"><strong>What this phase is about:</strong> This phase transforms a personal observation into structured scientific curiosity.</p>

                    <div class="observation-box" id="curiosityBox">
                        <p><strong>What if I combined shorter study sessions spread over time with self-quizzing after each session?</strong></p>
                    </div>

                    <div class="field">
                        <label>Based on your actual test taking experiences:</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="agree">
                                <span><strong>Agree</strong> - This reflects my experience exactly</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="disagree">
                                <span><strong>Disagree</strong> - This doesn't match my habits</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="curiosityResponse" value="unsure">
                                <span><strong>Unsure</strong> - I need to think about this more</span>
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <label for="curiosityExplanation">Briefly explain your choice:</label>
                        <textarea id="curiosityExplanation" placeholder="Why does/doesn't this question resonate with you? Have you ever tried combining spacing and retrieval?"></textarea>
                    </div>

                    <button class="btn btn-primary" id="curiosityContinueBtn" disabled>Continue to Research Question</button>
                </div>
            </section>

            <!-- Phase 3a: Research Question -->
            <section id="phase3a" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (1/3)</h2>
                    <div class="observation-box">
                        <h3>Research Question</h3>
                        <p style="font-weight: 600;">Does combining distributed practice with retrieval practice produce greater learning gains than using either strategy alone?</p>
                    </div>

                    <div class="field">
                        <label for="rqUnderstanding">Rate your understanding of this research question:</label>
                        <select id="rqUnderstanding">
                            <option value="">-- Select your understanding level --</option>
                            <option value="clear">Clear - I understand exactly what's being investigated</option>
                            <option value="somewhat">Somewhat - I have a general idea but some questions</option>
                            <option value="confused">Confused - I'm not sure what's being studied</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" id="rqContinueBtn" disabled>Proceed to Hypothesis →</button>
                </div>
            </section>

            <!-- Phase 3b: Hypothesis -->
            <section id="phase3b" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (2/3)</h2>

                    <h3>The Hypothesis</h3>
                    <div class="observation-box">
                        <p><strong>Combined spacing + retrieval</strong> (IV) produces <strong>greater learning gains</strong> (DV) than using either strategy independently when <strong>total study time is held constant</strong> (CV).</p>
                    </div>
                    <p class="meta" style="margin-top:0.5rem;"><strong>Why this works:</strong> Spacing allows consolidation, and retrieval strengthens memory traces. Together they create a synergistic effect stronger than either alone.</p>

                    <div class="field" style="margin-top: 1rem; border-top: 1px solid #eee; padding-top: 1rem;">
                        <label>Test Your Understanding: Which statement describes a valid Hypothesis?</label>
                        <div class="radio-group">
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="prediction_error">
                                <span>"If I study hard, I will get an A."</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="correct_answer">
                                <span>"It is a tentative answer to the Research Question proposing a relationship between variables."</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="radio" name="hypothesisFormat" value="vague_error">
                                <span>"It is a fact found in the textbook."</span>
                            </label>
                        </div>
                    </div>

                    <div class="hypothesis-feedback" id="hypothesisFeedback"></div>
                    <button class="btn btn-primary" id="hypothesisContinueBtn" disabled>Proceed to Your Prediction →</button>
                </div>
            </section>

            <!-- Phase 3c: Prediction -->
            <section id="phase3c" class="hidden">
                <div class="card stack">
                    <h2>Phase 3: Research Foundation (3/3) - Prediction</h2>

                    <div class="field">
                        <label for="predictionChoice">Based on the hypothesis, select which strategy you predict will produce the best results:</label>
                        <select id="predictionChoice">
                            <option value="">-- Select your prediction --</option>
                            <option value="combined">Spacing + Retrieval combined</option>
                            <option value="spacing">Spacing alone</option>
                            <option value="retrieval">Retrieval alone</option>
                        </select>
                    </div>

                    <div class="field">
                        <label for="predictionConfidence">How confident are you in this prediction? (1 = guessing, 5 = very confident)</label>
                        <input type="range" id="predictionConfidence" min="1" max="5" value="3">
                        <p class="meta">Confidence: <span id="confValue">3</span>/5</p>
                    </div>

                    <button class="btn btn-primary" id="predictionContinueBtn" disabled>Lock in my prediction →</button>
                </div>
            </section>

            <!-- Phase 4: Experimental Design -->
            <section id="phase4" class="hidden">
                <div class="card stack">
                    <h2>Phase 4: Experimental Design</h2>

                    <h3>The Original Study: Kang (2016)</h3>
                    <div class="observation-box">
                        <p>Three groups studied identical material. Group 1 used massed practice only (cramming). Group 2 used distributed practice only (spaced study sessions). Group 3 used distributed practice combined with retrieval practice (spaced sessions with self-quizzing). All groups spent equal total study time. Final test measured retention weeks later.</p>
                    </div>

                    <h3>My Personal Experiment Design</h3>
                    <div class="observation-box">
                        <p>I will choose material for my next exam and divide it into 3 study sessions over 5 days. After each session, I will quiz myself on that material without looking at my notes. On day 5, I'll do a final comprehensive quiz covering everything. I'll compare this approach to my usual cramming or rereading methods by tracking my quiz scores and how well I retain the information one week later.</p>
                    </div>

                    <button class="btn btn-primary" id="designContinueBtn">Show me the results</button>
                </div>
            </section>

            <!-- Phase 5: Results -->
            <section id="phase5" class="hidden">
                <div class="card stack">
                    <h2>Phase 5: The Results</h2>
                    <p class="explanation-box">Here is what happened in the original study.</p>

                    <div class="data-viz-box">
                        <canvas id="resultsChart" style="max-height:250px;"></canvas>
                    </div>

                    <div class="citation-box">
                        <h4>Original Study Details</h4>
                        <p class="meta"><strong>Citation:</strong> Kang, S. H. K. (2016). Spaced repetition promotes efficient and effective learning. Policy Insights from the Behavioral and Brain Sciences, 3(1), 12-19.</p>
                        <p class="meta"><strong>Result:</strong> The combination of spacing and retrieval produced significantly better learning than either strategy alone (86% vs 74% spacing alone vs 67% massed).</p>
                        <p class="meta"><strong>Effect Size:</strong> η² = 0.32 (large effect)</p>
                    </div>

                    <div class="observation-box" style="border-left: 3px solid var(--uwp-green);">
                        <h4>Conclusion</h4>
                        <p><strong>Hypothesis ACCEPTED.</strong> The strategies amplify each other. Spacing alone helps, but combined with retrieval creates synergistic learning gains.</p>
                    </div>

                    <div class="field">
                        <label for="resultsReflection">Your Metacognitive Reflection (Required):</label>
                        <p class="subline">How does this evidence challenge or confirm your current study habits?</p>
                        <textarea id="resultsReflection" placeholder="I was surprised to learn... This matters for my studying because... Will you try combining spacing and retrieval?"></textarea>
                        <p class="meta"><span id="reflectionWordCount">0</span> / 75 words minimum</p>
                    </div>

                    <button class="btn btn-primary" id="resultsContinueBtn" disabled>Continue to Design Your Experiment</button>
                </div>
            </section>

            <!-- Phase 6: Personal Experiment -->
            <section id="phase6" class="hidden">
                <div class="card stack">
                    <h2>Phase 6: Your Personal Experiment</h2>
                    <p class="explanation-box">Commit to applying this combined strategy in your actual coursework.</p>

                    <div class="field">
                        <label for="expCourse">Which course will you test this in?</label>
                        <input type="text" id="expCourse" placeholder="e.g., Biology 101">
                    </div>
                    <div class="field">
                        <label for="expMaterial">What specific material/topic?</label>
                        <input type="text" id="expMaterial" placeholder="e.g., Cellular Respiration, Cardiovascular system">
                    </div>
                    <div class="field">
                        <label for="expChange">What will you do differently? (Be specific about spacing AND retrieval)</label>
                        <textarea id="expChange" placeholder="I will study this material in 3 sessions over 5 days. After each session, I will..."></textarea>
                    </div>
                    <div class="field">
                        <label for="expMeasure">How will you measure success?</label>
                        <input type="text" id="expMeasure" placeholder="e.g., Quiz score improvement, retention after 1 week">
                    </div>
                    <div class="row-flex">
                        <div class="field">
                            <label for="expStart">Start Date</label>
                            <input type="date" id="expStart">
                        </div>
                        <div class="field">
                            <label for="expEval">Evaluation Date</label>
                            <input type="date" id="expEval">
                        </div>
                    </div>
                    <div style="margin: 0.5rem 0;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="expCommit">
                            <strong>I commit to running this experiment</strong>
                        </label>
                    </div>
                    <button class="btn btn-primary" id="commitContinueBtn" disabled>Complete Experiment</button>
                </div>
            </section>

            <!-- Phase 7: Completion -->
            <section id="phase7" class="hidden">
                <div class="card stack" style="text-align: center; border: 2px solid var(--uwp-green); background: #f0f9f0;">
                    <div style="font-size: 3rem; color: var(--uwp-green);">✓</div>
                    <h2>Experiment Complete!</h2>
                    <p>You have successfully designed a Combined Spacing + Retrieval strategy.</p>
                    <p class="meta">Congratulations on completing all 10 metacognitive experiments!</p>
                    <div class="row-flex" style="justify-content: center; margin-top: 1rem;">
                        <a href="../dashboard.html" class="btn btn-secondary">Return to Dashboard</a>
                        <a href="../roadmap.html" class="btn btn-primary">View Your Personalized Roadmap →</a>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/logic.js"></script>

    <script>
        const CURRENT_EXPERIMENT_ID = 'combined';

        // Helper to show next phase and scroll
        const goToPhase = (currentId, nextId) => {
            const nextPhase = document.getElementById(nextId);
            if (nextPhase) {
                nextPhase.classList.remove('hidden');
                nextPhase.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        // Initialize Specific Chart for Combined Strategy
        function renderSpecificChart() {
            const ctx = document.getElementById('resultsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Massed Only', 'Spaced Only', 'Spaced + Retrieval'],
                    datasets: [{
                        label: 'Retention (%)',
                        data: [67, 74, 86],
                        backgroundColor: ['#94a3b8', '#4b7c4c', '#016836'],
                        borderColor: ['#4b5563', '#00502f', '#00502f'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Combined Strategy Synergy (Retention after 1 week)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Retention (%)'
                            }
                        }
                    }
                }
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            if (typeof initExperiment === 'function') initExperiment(CURRENT_EXPERIMENT_ID);

            // Update local progress
            function updateLocalProgress() {
                let completedPhases = 0;
                for (let i = 1; i <= 7; i++) {
                    if (!document.getElementById(`phase${i}`).classList.contains('hidden')) {
                        completedPhases = i;
                    }
                }
                const progressPercentage = Math.round((completedPhases / 7) * 100);
                document.getElementById('localProgressBar').style.width = `${progressPercentage}%`;
                document.getElementById('localProgressLabel').textContent = `Phase ${completedPhases} of 7`;
            }

            // --- PHASE 1: Reflection Logic ---
            const reflectionInput = document.getElementById('reflectionText');
            const reflectionBtn = document.getElementById('reflectionContinueBtn');
            reflectionInput?.addEventListener('input', () => {
                const wordCount = reflectionInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('reflectionMeta').textContent = wordCount;
                reflectionBtn.disabled = wordCount < 50;
                updateLocalProgress();
            });
            reflectionBtn?.addEventListener('click', () => {
                goToPhase('phase1', 'phase2');
                updateLocalProgress();
            });

            // --- PHASE 2: Curiosity Logic ---
            const curiosityBtn = document.getElementById('curiosityContinueBtn');
            document.querySelectorAll('input[name="curiosityResponse"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    curiosityBtn.disabled = false;
                    updateLocalProgress();
                });
            });
            curiosityBtn?.addEventListener('click', () => {
                goToPhase('phase2', 'phase3a');
                updateLocalProgress();
            });

            // --- PHASE 3a: RQ Logic ---
            const rqBtn = document.getElementById('rqContinueBtn');
            document.getElementById('rqUnderstanding')?.addEventListener('change', (e) => {
                rqBtn.disabled = e.target.value === "";
                updateLocalProgress();
            });
            rqBtn?.addEventListener('click', () => {
                goToPhase('phase3a', 'phase3b');
                updateLocalProgress();
            });

            // --- PHASE 3b: Hypothesis Logic ---
            const hypBtn = document.getElementById('hypothesisContinueBtn');
            document.querySelectorAll('input[name="hypothesisFormat"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const feedback = document.getElementById('hypothesisFeedback');
                    if (e.target.value === 'correct_answer') {
                        feedback.innerHTML = "<p style='color:green;'>Correct! A hypothesis is a testable prediction about the relationship between variables.</p>";
                        feedback.style.display = 'block';
                        hypBtn.disabled = false;
                    } else {
                        feedback.innerHTML = "<p style='color:red;'>Not quite. A hypothesis should propose a testable relationship between variables, not just describe an outcome or state a fact.</p>";
                        feedback.style.display = 'block';
                        hypBtn.disabled = true;
                    }
                    updateLocalProgress();
                });
            });
            hypBtn?.addEventListener('click', () => {
                goToPhase('phase3b', 'phase3c');
                updateLocalProgress();
            });

            // --- PHASE 3c: Prediction Logic ---
            const predBtn = document.getElementById('predictionContinueBtn');
            document.getElementById('predictionChoice')?.addEventListener('change', (e) => {
                predBtn.disabled = e.target.value === "";
                updateLocalProgress();
            });
            predBtn?.addEventListener('click', () => {
                goToPhase('phase3c', 'phase4');
                updateLocalProgress();
            });

            // --- PHASE 4: Design Logic ---
            document.getElementById('designContinueBtn')?.addEventListener('click', () => {
                renderSpecificChart();
                goToPhase('phase4', 'phase5');
                updateLocalProgress();
            });

            // --- PHASE 5: Results Reflection ---
            const resInput = document.getElementById('resultsReflection');
            const resBtn = document.getElementById('resultsContinueBtn');
            resInput?.addEventListener('input', () => {
                const count = resInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('reflectionWordCount').textContent = count;
                resBtn.disabled = count < 75;
                updateLocalProgress();
            });
            resBtn?.addEventListener('click', () => {
                goToPhase('phase5', 'phase6');
                updateLocalProgress();
            });

            // --- PHASE 6: Personal Experiment Logic ---
            const commitBtn = document.getElementById('commitContinueBtn');
            document.getElementById('expCommit')?.addEventListener('change', (e) => {
                commitBtn.disabled = !e.target.checked;
                updateLocalProgress();
            });
            commitBtn?.addEventListener('click', () => {
                goToPhase('phase6', 'phase7');
                updateLocalProgress();
                
                // Mark this experiment as complete in localStorage
                if (typeof window.saveExperimentCompletion === 'function') {
                    window.saveExperimentCompletion(CURRENT_EXPERIMENT_ID);
                }
            });

            // Initial progress update
            updateLocalProgress();
        });
    </script>
</body>

</html>
